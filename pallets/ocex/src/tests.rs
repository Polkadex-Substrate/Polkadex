// This file is part of Polkadex.

// Copyright (C) 2020-2022 Polkadex o√º.
// SPDX-License-Identifier: GPL-3.0-or-later WITH Classpath-exception-2.0

// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.

// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
// GNU General Public License for more details.

//! Tests for pallet-ocex.

use crate::*;
use frame_support::{assert_noop, assert_ok, bounded_vec, traits::OnInitialize};
use polkadex_primitives::{
	assets::AssetId, ingress::IngressMessages, withdrawal::Withdrawal, Moment, SnapshotAccLimit,
};
use rust_decimal::prelude::FromPrimitive;
use sp_application_crypto::sp_core::H256;
// The testing primitives are very useful for avoiding having to work with signatures
// or public keys. `u64` is used as the `AccountId` and no `Signature`s are required.
use crate::mock::*;
use codec::Encode;
use frame_system::EventRecord;
use polkadex_primitives::{
	snapshot::{EnclaveSnapshot, Fees},
	AccountId, AssetsLimit, WithdrawalLimit,
};
use rust_decimal::Decimal;
use sp_application_crypto::RuntimePublic;
use sp_keystore::{testing::KeyStore, KeystoreExt, SyncCryptoStore};
use sp_runtime::{
	traits::CheckedConversion, AccountId32, BoundedBTreeMap, BoundedVec, DispatchError::BadOrigin,
	TokenError,
};
use std::sync::Arc;

pub const KEY_TYPE: sp_application_crypto::KeyTypeId = sp_application_crypto::KeyTypeId(*b"ocex");

use codec::Decode;
use ias_verify::verify_ias_report;
use test_utils::ias::ias::TEST4_SETUP;

fn assert_last_event<T: Config>(generic_event: <T as Config>::Event) {
	let events = frame_system::Pallet::<T>::events();
	let system_event: <T as frame_system::Config>::Event = generic_event.into();
	// compare to the last event record
	let EventRecord { event, .. } = &events[events.len() - 1];
	assert_eq!(event, &system_event);
}

#[test]
fn test_attestation_verification() {
	let report = [
		123, 34, 99, 112, 117, 115, 118, 110, 34, 58, 91, 49, 57, 44, 49, 57, 44, 50, 44, 55, 44,
		50, 53, 53, 44, 49, 50, 56, 44, 54, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 93, 44, 34, 109, 105, 115, 99, 115, 101, 108, 101, 99, 116, 34, 58, 123,
		34, 98, 105, 116, 115, 34, 58, 48, 125, 44, 34, 97, 116, 116, 114, 105, 98, 117, 116, 101,
		115, 34, 58, 123, 34, 102, 108, 97, 103, 115, 34, 58, 123, 34, 98, 105, 116, 115, 34, 58,
		55, 125, 44, 34, 120, 102, 114, 109, 34, 58, 55, 125, 44, 34, 109, 114, 101, 110, 99, 108,
		97, 118, 101, 34, 58, 91, 49, 54, 50, 44, 49, 56, 48, 44, 49, 54, 50, 44, 49, 48, 48, 44,
		49, 55, 52, 44, 49, 52, 54, 44, 49, 52, 52, 44, 55, 54, 44, 54, 50, 44, 53, 57, 44, 56, 53,
		44, 49, 53, 53, 44, 49, 51, 57, 44, 57, 56, 44, 49, 57, 55, 44, 50, 51, 51, 44, 49, 48, 52,
		44, 50, 49, 56, 44, 49, 50, 50, 44, 50, 48, 54, 44, 49, 57, 51, 44, 56, 53, 44, 54, 51, 44,
		51, 52, 44, 54, 55, 44, 54, 53, 44, 50, 51, 54, 44, 49, 50, 56, 44, 50, 52, 51, 44, 49, 48,
		55, 44, 50, 48, 50, 44, 49, 57, 53, 93, 44, 34, 109, 114, 115, 105, 103, 110, 101, 114, 34,
		58, 91, 57, 53, 44, 49, 56, 51, 44, 49, 52, 49, 44, 53, 55, 44, 55, 53, 44, 49, 48, 49, 44,
		49, 52, 57, 44, 50, 52, 54, 44, 56, 53, 44, 50, 50, 55, 44, 50, 49, 57, 44, 55, 49, 44, 49,
		52, 44, 49, 52, 51, 44, 49, 52, 51, 44, 55, 57, 44, 50, 44, 50, 48, 57, 44, 49, 50, 55, 44,
		49, 54, 53, 44, 49, 49, 55, 44, 50, 48, 54, 44, 49, 56, 53, 44, 55, 51, 44, 56, 49, 44, 50,
		50, 56, 44, 49, 44, 50, 50, 53, 44, 49, 53, 48, 44, 49, 49, 54, 44, 50, 52, 50, 44, 51, 56,
		93, 44, 34, 105, 115, 118, 112, 114, 111, 100, 105, 100, 34, 58, 48, 44, 34, 105, 115, 118,
		115, 118, 110, 34, 58, 48, 44, 34, 114, 101, 112, 111, 114, 116, 100, 97, 116, 97, 34, 58,
		91, 49, 53, 54, 44, 56, 49, 44, 49, 57, 52, 44, 51, 53, 44, 49, 55, 52, 44, 50, 52, 50, 44,
		49, 51, 52, 44, 54, 50, 44, 49, 50, 49, 44, 50, 49, 49, 44, 49, 53, 54, 44, 49, 54, 49, 44,
		53, 55, 44, 55, 52, 44, 49, 52, 57, 44, 50, 50, 49, 44, 49, 52, 54, 44, 50, 51, 52, 44, 50,
		48, 52, 44, 50, 57, 44, 50, 53, 52, 44, 56, 52, 44, 50, 50, 51, 44, 50, 52, 50, 44, 49, 51,
		51, 44, 57, 56, 44, 49, 50, 52, 44, 50, 48, 54, 44, 49, 55, 55, 44, 55, 57, 44, 50, 48, 48,
		44, 55, 51, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 93, 44,
		34, 107, 101, 121, 105, 100, 34, 58, 91, 50, 50, 52, 44, 49, 50, 53, 44, 50, 49, 48, 44,
		49, 54, 48, 44, 50, 49, 48, 44, 51, 56, 44, 50, 49, 52, 44, 49, 53, 57, 44, 55, 54, 44, 55,
		51, 44, 50, 49, 53, 44, 49, 56, 55, 44, 49, 48, 54, 44, 56, 56, 44, 49, 51, 52, 44, 49, 51,
		56, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 93, 44, 34, 109, 97, 99, 34, 58, 91, 56, 57, 44,
		49, 51, 50, 44, 54, 54, 44, 50, 52, 56, 44, 50, 49, 57, 44, 49, 48, 50, 44, 52, 53, 44, 49,
		57, 57, 44, 56, 50, 44, 50, 51, 56, 44, 49, 54, 55, 44, 49, 49, 51, 44, 49, 52, 56, 44, 50,
		51, 53, 44, 49, 57, 54, 44, 53, 48, 93, 125,
	];
	let old_rec_report = [
		48, 130, 20, 200, 48, 130, 20, 110, 160, 3, 2, 1, 2, 2, 1, 1, 48, 10, 6, 8, 42, 134, 72,
		206, 61, 4, 3, 2, 48, 19, 49, 17, 48, 15, 6, 3, 85, 4, 3, 12, 8, 80, 79, 76, 75, 65, 68,
		69, 88, 48, 30, 23, 13, 50, 50, 48, 57, 50, 54, 49, 57, 51, 48, 49, 55, 90, 23, 13, 50, 50,
		48, 57, 50, 55, 49, 57, 51, 48, 49, 55, 90, 48, 31, 49, 29, 48, 27, 6, 3, 85, 4, 3, 12, 20,
		80, 79, 76, 75, 65, 68, 69, 88, 32, 97, 116, 116, 101, 115, 116, 97, 116, 105, 111, 110,
		48, 89, 48, 19, 6, 7, 42, 134, 72, 206, 61, 2, 1, 6, 8, 42, 134, 72, 206, 61, 3, 1, 7, 3,
		66, 0, 4, 189, 239, 23, 177, 124, 141, 170, 154, 217, 213, 43, 16, 96, 91, 67, 84, 255, 77,
		200, 29, 67, 24, 253, 0, 227, 12, 236, 176, 184, 110, 78, 82, 245, 139, 80, 181, 223, 232,
		216, 251, 33, 60, 138, 170, 229, 170, 238, 214, 137, 137, 61, 70, 184, 187, 97, 183, 61,
		24, 172, 203, 63, 43, 148, 8, 163, 130, 19, 165, 48, 130, 19, 161, 48, 130, 19, 157, 6, 9,
		96, 134, 72, 1, 134, 248, 66, 1, 13, 4, 130, 19, 142, 123, 34, 105, 100, 34, 58, 34, 53,
		56, 50, 51, 52, 49, 52, 52, 48, 53, 55, 48, 49, 53, 49, 55, 50, 49, 51, 54, 50, 52, 52, 56,
		53, 51, 52, 53, 48, 56, 50, 53, 50, 55, 50, 55, 57, 34, 44, 34, 116, 105, 109, 101, 115,
		116, 97, 109, 112, 34, 58, 34, 50, 48, 50, 50, 45, 48, 57, 45, 50, 54, 84, 49, 57, 58, 51,
		48, 58, 49, 55, 46, 53, 53, 52, 57, 57, 50, 34, 44, 34, 118, 101, 114, 115, 105, 111, 110,
		34, 58, 52, 44, 34, 105, 115, 118, 69, 110, 99, 108, 97, 118, 101, 81, 117, 111, 116, 101,
		83, 116, 97, 116, 117, 115, 34, 58, 34, 83, 87, 95, 72, 65, 82, 68, 69, 78, 73, 78, 71, 95,
		78, 69, 69, 68, 69, 68, 34, 44, 34, 105, 115, 118, 69, 110, 99, 108, 97, 118, 101, 81, 117,
		111, 116, 101, 66, 111, 100, 121, 34, 58, 91, 50, 44, 48, 44, 49, 44, 48, 44, 55, 53, 44,
		49, 50, 44, 48, 44, 48, 44, 49, 51, 44, 48, 44, 49, 51, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 50, 53, 48, 44, 54, 51, 44, 50, 50, 54, 44, 49, 48, 54, 44, 50, 49, 54, 44, 50, 51,
		50, 44, 57, 54, 44, 53, 55, 44, 51, 49, 44, 50, 56, 44, 49, 54, 52, 44, 52, 55, 44, 55, 51,
		44, 49, 52, 54, 44, 49, 57, 44, 50, 49, 56, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 49, 57,
		44, 49, 57, 44, 50, 44, 55, 44, 50, 53, 53, 44, 49, 50, 56, 44, 54, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 55, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 55, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 49, 54, 50, 44, 49, 56,
		48, 44, 49, 54, 50, 44, 49, 48, 48, 44, 49, 55, 52, 44, 49, 52, 54, 44, 49, 52, 52, 44, 55,
		54, 44, 54, 50, 44, 53, 57, 44, 56, 53, 44, 49, 53, 53, 44, 49, 51, 57, 44, 57, 56, 44, 49,
		57, 55, 44, 50, 51, 51, 44, 49, 48, 52, 44, 50, 49, 56, 44, 49, 50, 50, 44, 50, 48, 54, 44,
		49, 57, 51, 44, 56, 53, 44, 54, 51, 44, 51, 52, 44, 54, 55, 44, 54, 53, 44, 50, 51, 54, 44,
		49, 50, 56, 44, 50, 52, 51, 44, 49, 48, 55, 44, 50, 48, 50, 44, 49, 57, 53, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 57, 53, 44, 49, 56, 51, 44, 49,
		52, 49, 44, 53, 55, 44, 55, 53, 44, 49, 48, 49, 44, 49, 52, 57, 44, 50, 52, 54, 44, 56, 53,
		44, 50, 50, 55, 44, 50, 49, 57, 44, 55, 49, 44, 49, 52, 44, 49, 52, 51, 44, 49, 52, 51, 44,
		55, 57, 44, 50, 44, 50, 48, 57, 44, 49, 50, 55, 44, 49, 54, 53, 44, 49, 49, 55, 44, 50, 48,
		54, 44, 49, 56, 53, 44, 55, 51, 44, 56, 49, 44, 50, 50, 56, 44, 49, 44, 50, 50, 53, 44, 49,
		53, 48, 44, 49, 49, 54, 44, 50, 52, 50, 44, 51, 56, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 49, 53, 54, 44, 56, 49, 44, 49, 57, 52, 44,
		51, 53, 44, 49, 55, 52, 44, 50, 52, 50, 44, 49, 51, 52, 44, 54, 50, 44, 49, 50, 49, 44, 50,
		49, 49, 44, 49, 53, 54, 44, 49, 54, 49, 44, 53, 55, 44, 55, 52, 44, 49, 52, 57, 44, 50, 50,
		49, 44, 49, 52, 54, 44, 50, 51, 52, 44, 50, 48, 52, 44, 50, 57, 44, 50, 53, 52, 44, 56, 52,
		44, 50, 50, 51, 44, 50, 52, 50, 44, 49, 51, 51, 44, 57, 56, 44, 49, 50, 52, 44, 50, 48, 54,
		44, 49, 55, 55, 44, 55, 57, 44, 50, 48, 48, 44, 55, 51, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48,
		44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44, 48, 44,
		48, 44, 48, 44, 48, 44, 48, 44, 48, 93, 44, 34, 101, 112, 105, 100, 80, 115, 101, 117, 100,
		111, 110, 121, 109, 34, 58, 91, 50, 52, 49, 44, 55, 53, 44, 49, 51, 53, 44, 49, 52, 44, 56,
		54, 44, 50, 57, 44, 50, 50, 52, 44, 50, 50, 50, 44, 49, 49, 50, 44, 49, 55, 48, 44, 49, 52,
		56, 44, 50, 48, 54, 44, 49, 49, 50, 44, 55, 48, 44, 50, 49, 52, 44, 53, 55, 44, 49, 49, 48,
		44, 49, 56, 48, 44, 54, 57, 44, 50, 50, 56, 44, 50, 50, 48, 44, 49, 57, 48, 44, 53, 55, 44,
		49, 49, 44, 57, 50, 44, 50, 53, 52, 44, 49, 49, 51, 44, 56, 48, 44, 55, 53, 44, 53, 48, 44,
		57, 51, 44, 53, 50, 44, 50, 51, 54, 44, 54, 52, 44, 49, 50, 44, 52, 51, 44, 52, 44, 52, 57,
		44, 54, 54, 44, 49, 57, 52, 44, 49, 49, 57, 44, 49, 50, 48, 44, 50, 49, 56, 44, 49, 51, 57,
		44, 49, 48, 49, 44, 56, 52, 44, 50, 51, 50, 44, 49, 57, 52, 44, 49, 52, 50, 44, 54, 54, 44,
		50, 52, 56, 44, 54, 50, 44, 49, 53, 57, 44, 49, 56, 44, 56, 57, 44, 52, 55, 44, 54, 56, 44,
		49, 54, 48, 44, 49, 53, 57, 44, 50, 52, 53, 44, 54, 44, 57, 53, 44, 49, 50, 44, 55, 44, 49,
		52, 52, 44, 52, 56, 44, 49, 54, 50, 44, 50, 48, 50, 44, 50, 49, 51, 44, 55, 44, 53, 55, 44,
		51, 55, 44, 49, 50, 53, 44, 49, 52, 56, 44, 49, 48, 55, 44, 50, 53, 49, 44, 49, 54, 52, 44,
		50, 51, 52, 44, 50, 52, 56, 44, 51, 56, 44, 49, 50, 56, 44, 49, 55, 51, 44, 50, 57, 44, 49,
		48, 50, 44, 55, 51, 44, 49, 44, 49, 54, 56, 44, 57, 52, 44, 49, 55, 44, 49, 52, 54, 44, 49,
		57, 55, 44, 50, 48, 54, 44, 52, 50, 44, 51, 53, 44, 49, 51, 51, 44, 54, 54, 44, 49, 50, 55,
		44, 49, 57, 44, 50, 49, 53, 44, 49, 50, 48, 44, 50, 50, 54, 44, 50, 48, 48, 44, 53, 54, 44,
		49, 50, 50, 44, 50, 54, 44, 51, 44, 49, 56, 52, 44, 49, 50, 52, 44, 57, 50, 44, 49, 50, 57,
		44, 49, 48, 54, 44, 50, 48, 54, 44, 50, 52, 52, 44, 49, 44, 50, 49, 48, 44, 49, 52, 53, 44,
		49, 48, 49, 44, 50, 50, 52, 44, 56, 49, 44, 56, 54, 44, 50, 49, 44, 50, 50, 56, 44, 51, 55,
		44, 49, 49, 50, 44, 49, 51, 55, 44, 50, 49, 44, 51, 54, 44, 50, 52, 53, 93, 44, 34, 97,
		100, 118, 105, 115, 111, 114, 121, 85, 82, 76, 34, 58, 34, 104, 116, 116, 112, 115, 58, 47,
		47, 115, 101, 99, 117, 114, 105, 116, 121, 45, 99, 101, 110, 116, 101, 114, 46, 105, 110,
		116, 101, 108, 46, 99, 111, 109, 34, 44, 34, 97, 100, 118, 105, 115, 111, 114, 121, 73, 68,
		115, 34, 58, 91, 34, 73, 78, 84, 69, 76, 45, 83, 65, 45, 48, 48, 51, 51, 52, 34, 93, 125,
		124, 57, 51, 51, 55, 101, 97, 48, 51, 97, 100, 54, 98, 102, 102, 52, 99, 102, 53, 97, 98,
		101, 53, 100, 102, 52, 49, 102, 53, 54, 102, 97, 53, 102, 101, 52, 54, 53, 97, 97, 99, 100,
		51, 48, 102, 98, 56, 98, 50, 53, 98, 100, 97, 56, 99, 100, 57, 53, 56, 99, 52, 49, 99, 50,
		53, 101, 100, 51, 98, 52, 57, 50, 97, 53, 99, 101, 54, 53, 54, 50, 48, 101, 50, 49, 48,
		101, 100, 52, 55, 57, 57, 53, 50, 50, 53, 52, 99, 49, 97, 49, 98, 97, 55, 56, 99, 100, 48,
		56, 100, 54, 54, 55, 55, 56, 102, 98, 55, 52, 102, 52, 51, 53, 51, 50, 57, 99, 53, 101, 98,
		48, 99, 102, 100, 49, 56, 49, 99, 57, 56, 54, 49, 57, 50, 51, 55, 52, 50, 99, 99, 51, 56,
		100, 99, 53, 98, 57, 101, 56, 101, 100, 49, 49, 50, 55, 101, 55, 49, 54, 97, 52, 98, 56,
		57, 97, 48, 49, 102, 100, 56, 48, 101, 55, 52, 53, 48, 55, 99, 49, 48, 54, 56, 49, 102,
		102, 52, 54, 52, 98, 54, 97, 52, 53, 102, 51, 100, 48, 99, 48, 102, 54, 52, 100, 55, 51,
		54, 101, 98, 54, 52, 56, 102, 98, 97, 99, 49, 57, 56, 51, 53, 102, 48, 101, 52, 97, 48, 98,
		102, 53, 102, 55, 51, 101, 57, 100, 55, 51, 55, 52, 97, 101, 53, 101, 97, 50, 55, 57, 57,
		53, 49, 56, 99, 55, 48, 53, 55, 101, 51, 99, 54, 99, 50, 52, 48, 56, 57, 100, 101, 55, 97,
		49, 101, 100, 99, 49, 98, 98, 51, 52, 57, 102, 48, 49, 99, 54, 97, 53, 102, 97, 52, 48, 51,
		54, 102, 51, 98, 55, 54, 98, 102, 98, 57, 57, 57, 57, 101, 57, 53, 101, 49, 49, 55, 57, 97,
		99, 54, 48, 100, 56, 57, 48, 54, 49, 49, 102, 57, 48, 53, 55, 50, 57, 50, 100, 55, 55, 98,
		97, 99, 100, 98, 97, 100, 50, 102, 97, 54, 98, 48, 51, 55, 99, 49, 51, 99, 48, 98, 51, 101,
		48, 98, 98, 50, 49, 54, 49, 101, 50, 54, 51, 56, 54, 98, 101, 48, 55, 48, 56, 56, 53, 56,
		50, 98, 53, 98, 51, 48, 102, 99, 51, 49, 55, 100, 51, 56, 99, 56, 52, 102, 49, 48, 48, 48,
		55, 102, 49, 50, 100, 101, 49, 97, 101, 53, 51, 48, 56, 97, 100, 99, 57, 99, 49, 99, 54,
		49, 57, 48, 54, 101, 97, 99, 49, 50, 55, 52, 56, 49, 55, 48, 100, 57, 99, 98, 101, 48, 101,
		54, 54, 51, 52, 52, 53, 53, 97, 48, 99, 53, 102, 100, 51, 51, 102, 98, 53, 100, 53, 54, 50,
		101, 51, 102, 98, 52, 56, 50, 52, 51, 98, 99, 56, 50, 100, 98, 99, 49, 97, 102, 55, 57,
		100, 54, 53, 52, 55, 55, 102, 100, 99, 53, 56, 54, 48, 56, 50, 57, 124, 51, 48, 56, 50, 48,
		53, 52, 98, 51, 48, 56, 50, 48, 51, 98, 51, 97, 48, 48, 51, 48, 50, 48, 49, 48, 50, 48, 50,
		48, 57, 48, 48, 100, 49, 48, 55, 55, 54, 53, 100, 51, 50, 97, 51, 98, 48, 57, 52, 51, 48,
		48, 100, 48, 54, 48, 57, 50, 97, 56, 54, 52, 56, 56, 54, 102, 55, 48, 100, 48, 49, 48, 49,
		48, 98, 48, 53, 48, 48, 51, 48, 55, 101, 51, 49, 48, 98, 51, 48, 48, 57, 48, 54, 48, 51,
		53, 53, 48, 52, 48, 54, 49, 51, 48, 50, 53, 53, 53, 51, 51, 49, 48, 98, 51, 48, 48, 57, 48,
		54, 48, 51, 53, 53, 48, 52, 48, 56, 48, 99, 48, 50, 52, 51, 52, 49, 51, 49, 49, 52, 51, 48,
		49, 50, 48, 54, 48, 51, 53, 53, 48, 52, 48, 55, 48, 99, 48, 98, 53, 51, 54, 49, 54, 101,
		55, 52, 54, 49, 50, 48, 52, 51, 54, 99, 54, 49, 55, 50, 54, 49, 51, 49, 49, 97, 51, 48, 49,
		56, 48, 54, 48, 51, 53, 53, 48, 52, 48, 97, 48, 99, 49, 49, 52, 57, 54, 101, 55, 52, 54,
		53, 54, 99, 50, 48, 52, 51, 54, 102, 55, 50, 55, 48, 54, 102, 55, 50, 54, 49, 55, 52, 54,
		57, 54, 102, 54, 101, 51, 49, 51, 48, 51, 48, 50, 101, 48, 54, 48, 51, 53, 53, 48, 52, 48,
		51, 48, 99, 50, 55, 52, 57, 54, 101, 55, 52, 54, 53, 54, 99, 50, 48, 53, 51, 52, 55, 53,
		56, 50, 48, 52, 49, 55, 52, 55, 52, 54, 53, 55, 51, 55, 52, 54, 49, 55, 52, 54, 57, 54,
		102, 54, 101, 50, 48, 53, 50, 54, 53, 55, 48, 54, 102, 55, 50, 55, 52, 50, 48, 53, 51, 54,
		57, 54, 55, 54, 101, 54, 57, 54, 101, 54, 55, 50, 48, 52, 51, 52, 49, 51, 48, 50, 48, 49,
		55, 48, 100, 51, 49, 51, 54, 51, 49, 51, 49, 51, 49, 51, 52, 51, 49, 51, 53, 51, 51, 51,
		55, 51, 51, 51, 49, 53, 97, 49, 56, 48, 102, 51, 50, 51, 48, 51, 52, 51, 57, 51, 49, 51,
		50, 51, 51, 51, 49, 51, 50, 51, 51, 51, 53, 51, 57, 51, 53, 51, 57, 53, 97, 51, 48, 55,
		101, 51, 49, 48, 98, 51, 48, 48, 57, 48, 54, 48, 51, 53, 53, 48, 52, 48, 54, 49, 51, 48,
		50, 53, 53, 53, 51, 51, 49, 48, 98, 51, 48, 48, 57, 48, 54, 48, 51, 53, 53, 48, 52, 48, 56,
		48, 99, 48, 50, 52, 51, 52, 49, 51, 49, 49, 52, 51, 48, 49, 50, 48, 54, 48, 51, 53, 53, 48,
		52, 48, 55, 48, 99, 48, 98, 53, 51, 54, 49, 54, 101, 55, 52, 54, 49, 50, 48, 52, 51, 54,
		99, 54, 49, 55, 50, 54, 49, 51, 49, 49, 97, 51, 48, 49, 56, 48, 54, 48, 51, 53, 53, 48, 52,
		48, 97, 48, 99, 49, 49, 52, 57, 54, 101, 55, 52, 54, 53, 54, 99, 50, 48, 52, 51, 54, 102,
		55, 50, 55, 48, 54, 102, 55, 50, 54, 49, 55, 52, 54, 57, 54, 102, 54, 101, 51, 49, 51, 48,
		51, 48, 50, 101, 48, 54, 48, 51, 53, 53, 48, 52, 48, 51, 48, 99, 50, 55, 52, 57, 54, 101,
		55, 52, 54, 53, 54, 99, 50, 48, 53, 51, 52, 55, 53, 56, 50, 48, 52, 49, 55, 52, 55, 52, 54,
		53, 55, 51, 55, 52, 54, 49, 55, 52, 54, 57, 54, 102, 54, 101, 50, 48, 53, 50, 54, 53, 55,
		48, 54, 102, 55, 50, 55, 52, 50, 48, 53, 51, 54, 57, 54, 55, 54, 101, 54, 57, 54, 101, 54,
		55, 50, 48, 52, 51, 52, 49, 51, 48, 56, 50, 48, 49, 97, 50, 51, 48, 48, 100, 48, 54, 48,
		57, 50, 97, 56, 54, 52, 56, 56, 54, 102, 55, 48, 100, 48, 49, 48, 49, 48, 49, 48, 53, 48,
		48, 48, 51, 56, 50, 48, 49, 56, 102, 48, 48, 51, 48, 56, 50, 48, 49, 56, 97, 48, 50, 56,
		50, 48, 49, 56, 49, 48, 48, 57, 102, 51, 99, 54, 52, 55, 101, 98, 53, 55, 55, 51, 99, 98,
		98, 53, 49, 50, 100, 50, 55, 51, 50, 99, 48, 100, 55, 52, 49, 53, 101, 98, 98, 53, 53, 97,
		48, 102, 97, 57, 101, 100, 101, 50, 101, 54, 52, 57, 49, 57, 57, 101, 54, 56, 50, 49, 100,
		98, 57, 49, 48, 100, 53, 51, 49, 55, 55, 51, 55, 48, 57, 55, 55, 52, 54, 54, 97, 54, 97,
		53, 101, 52, 55, 56, 54, 99, 99, 100, 50, 100, 100, 101, 98, 100, 52, 49, 52, 57, 100, 54,
		97, 50, 102, 54, 51, 50, 53, 53, 50, 57, 100, 100, 49, 48, 99, 99, 57, 56, 55, 51, 55, 98,
		48, 55, 55, 57, 99, 49, 97, 48, 55, 101, 50, 57, 99, 52, 55, 97, 49, 97, 101, 48, 48, 52,
		57, 52, 56, 52, 55, 54, 99, 52, 56, 57, 102, 52, 53, 97, 53, 97, 49, 53, 100, 55, 97, 99,
		56, 101, 99, 99, 54, 97, 99, 99, 54, 52, 53, 97, 100, 98, 52, 51, 100, 56, 55, 54, 55, 57,
		100, 102, 53, 57, 99, 48, 57, 51, 98, 99, 53, 97, 50, 101, 57, 54, 57, 54, 99, 53, 52, 55,
		56, 53, 52, 49, 98, 57, 55, 57, 101, 55, 53, 52, 98, 53, 55, 51, 57, 49, 52, 98, 101, 53,
		53, 100, 51, 50, 102, 102, 52, 99, 48, 57, 100, 100, 102, 50, 55, 50, 49, 57, 57, 51, 52,
		99, 100, 57, 57, 48, 53, 50, 55, 98, 51, 102, 57, 50, 101, 100, 55, 56, 102, 98, 102, 50,
		57, 50, 52, 54, 97, 98, 101, 99, 98, 55, 49, 50, 52, 48, 101, 102, 51, 57, 99, 50, 100, 55,
		49, 48, 55, 98, 52, 52, 55, 53, 52, 53, 97, 55, 102, 102, 98, 49, 48, 101, 98, 48, 54, 48,
		97, 54, 56, 97, 57, 56, 53, 56, 48, 50, 49, 57, 101, 51, 54, 57, 49, 48, 57, 53, 50, 54,
		56, 51, 56, 57, 50, 100, 54, 97, 53, 101, 50, 97, 56, 48, 56, 48, 51, 49, 57, 51, 101, 52,
		48, 55, 53, 51, 49, 52, 48, 52, 101, 51, 54, 98, 51, 49, 53, 54, 50, 51, 55, 57, 57, 97,
		97, 56, 50, 53, 48, 55, 52, 52, 48, 57, 55, 53, 52, 97, 50, 100, 102, 101, 56, 102, 53, 97,
		102, 100, 53, 102, 101, 54, 51, 49, 101, 49, 102, 99, 50, 97, 102, 51, 56, 48, 56, 57, 48,
		54, 102, 50, 56, 97, 55, 57, 48, 100, 57, 100, 100, 57, 102, 101, 48, 54, 48, 57, 51, 57,
		98, 49, 50, 53, 55, 57, 48, 99, 53, 56, 48, 53, 100, 48, 51, 55, 100, 102, 53, 54, 97, 57,
		57, 53, 51, 49, 98, 57, 54, 100, 101, 54, 57, 100, 101, 51, 51, 101, 100, 50, 50, 54, 99,
		99, 49, 50, 48, 55, 100, 49, 48, 52, 50, 98, 53, 99, 57, 97, 98, 55, 102, 52, 48, 52, 102,
		99, 55, 49, 49, 99, 48, 102, 101, 52, 55, 54, 57, 102, 98, 57, 53, 55, 56, 98, 49, 100, 99,
		48, 101, 99, 52, 54, 57, 101, 97, 49, 97, 50, 53, 101, 48, 102, 102, 57, 57, 49, 52, 56,
		56, 54, 101, 102, 50, 54, 57, 57, 98, 50, 51, 53, 98, 98, 52, 56, 52, 55, 100, 100, 54,
		102, 102, 52, 48, 98, 54, 48, 54, 101, 54, 49, 55, 48, 55, 57, 51, 99, 50, 102, 98, 57, 56,
		98, 51, 49, 52, 53, 56, 55, 102, 57, 99, 102, 100, 50, 53, 55, 51, 54, 50, 100, 102, 101,
		97, 98, 49, 48, 98, 51, 98, 100, 50, 100, 57, 55, 54, 55, 51, 97, 49, 97, 52, 98, 100, 52,
		52, 99, 52, 53, 51, 97, 97, 102, 52, 55, 102, 99, 49, 102, 50, 100, 51, 100, 48, 102, 51,
		56, 52, 102, 55, 52, 97, 48, 54, 102, 56, 57, 99, 48, 56, 57, 102, 48, 100, 97, 54, 99,
		100, 98, 55, 102, 99, 101, 101, 101, 56, 99, 57, 56, 50, 49, 97, 56, 101, 53, 52, 102, 50,
		53, 99, 48, 52, 49, 54, 100, 49, 56, 99, 52, 54, 56, 51, 57, 97, 53, 102, 56, 48, 49, 50,
		102, 98, 100, 100, 51, 100, 99, 55, 52, 100, 50, 53, 54, 50, 55, 57, 97, 100, 99, 50, 99,
		48, 100, 53, 53, 97, 102, 102, 54, 102, 48, 54, 50, 50, 52, 50, 53, 100, 49, 98, 48, 50,
		48, 51, 48, 49, 48, 48, 48, 49, 97, 51, 56, 49, 99, 57, 51, 48, 56, 49, 99, 54, 51, 48, 54,
		48, 48, 54, 48, 51, 53, 53, 49, 100, 49, 102, 48, 52, 53, 57, 51, 48, 53, 55, 51, 48, 53,
		53, 97, 48, 53, 51, 97, 48, 53, 49, 56, 54, 52, 102, 54, 56, 55, 52, 55, 52, 55, 48, 51,
		97, 50, 102, 50, 102, 55, 52, 55, 50, 55, 53, 55, 51, 55, 52, 54, 53, 54, 52, 55, 51, 54,
		53, 55, 50, 55, 54, 54, 57, 54, 51, 54, 53, 55, 51, 50, 101, 54, 57, 54, 101, 55, 52, 54,
		53, 54, 99, 50, 101, 54, 51, 54, 102, 54, 100, 50, 102, 54, 51, 54, 102, 54, 101, 55, 52,
		54, 53, 54, 101, 55, 52, 50, 102, 52, 51, 53, 50, 52, 99, 50, 102, 53, 51, 52, 55, 53, 56,
		50, 102, 52, 49, 55, 52, 55, 52, 54, 53, 55, 51, 55, 52, 54, 49, 55, 52, 54, 57, 54, 102,
		54, 101, 53, 50, 54, 53, 55, 48, 54, 102, 55, 50, 55, 52, 53, 51, 54, 57, 54, 55, 54, 101,
		54, 57, 54, 101, 54, 55, 52, 51, 52, 49, 50, 101, 54, 51, 55, 50, 54, 99, 51, 48, 49, 100,
		48, 54, 48, 51, 53, 53, 49, 100, 48, 101, 48, 52, 49, 54, 48, 52, 49, 52, 55, 56, 52, 51,
		55, 98, 55, 54, 97, 54, 55, 101, 98, 99, 100, 48, 97, 102, 55, 101, 52, 50, 51, 55, 101,
		98, 51, 53, 55, 99, 51, 98, 56, 55, 48, 49, 53, 49, 51, 99, 51, 48, 49, 102, 48, 54, 48,
		51, 53, 53, 49, 100, 50, 51, 48, 52, 49, 56, 51, 48, 49, 54, 56, 48, 49, 52, 55, 56, 52,
		51, 55, 98, 55, 54, 97, 54, 55, 101, 98, 99, 100, 48, 97, 102, 55, 101, 52, 50, 51, 55,
		101, 98, 51, 53, 55, 99, 51, 98, 56, 55, 48, 49, 53, 49, 51, 99, 51, 48, 48, 101, 48, 54,
		48, 51, 53, 53, 49, 100, 48, 102, 48, 49, 48, 49, 102, 102, 48, 52, 48, 52, 48, 51, 48, 50,
		48, 49, 48, 54, 51, 48, 49, 50, 48, 54, 48, 51, 53, 53, 49, 100, 49, 51, 48, 49, 48, 49,
		102, 102, 48, 52, 48, 56, 51, 48, 48, 54, 48, 49, 48, 49, 102, 102, 48, 50, 48, 49, 48, 48,
		51, 48, 48, 100, 48, 54, 48, 57, 50, 97, 56, 54, 52, 56, 56, 54, 102, 55, 48, 100, 48, 49,
		48, 49, 48, 98, 48, 53, 48, 48, 48, 51, 56, 50, 48, 49, 56, 49, 48, 48, 55, 56, 53, 102,
		50, 100, 54, 48, 99, 53, 99, 56, 48, 97, 102, 52, 50, 97, 55, 57, 55, 54, 49, 48, 50, 49,
		51, 57, 49, 53, 100, 97, 56, 50, 99, 57, 98, 50, 57, 101, 56, 57, 101, 48, 57, 48, 50, 97,
		50, 53, 97, 54, 99, 55, 53, 98, 49, 54, 48, 57, 49, 99, 54, 56, 97, 98, 50, 48, 52, 97, 97,
		101, 55, 49, 49, 56, 56, 57, 52, 57, 50, 99, 55, 101, 49, 101, 51, 50, 48, 57, 49, 49, 52,
		53, 53, 97, 56, 102, 99, 49, 51, 52, 52, 50, 51, 49, 50, 101, 55, 55, 97, 54, 51, 57, 57,
		52, 100, 57, 57, 55, 57, 53, 99, 56, 101, 97, 52, 53, 55, 54, 56, 50, 51, 99, 101, 97, 56,
		97, 100, 49, 101, 49, 57, 49, 99, 102, 97, 56, 54, 50, 102, 97, 98, 56, 97, 57, 51, 50,
		100, 51, 100, 57, 98, 48, 53, 51, 53, 97, 48, 55, 48, 50, 100, 48, 53, 53, 53, 102, 55, 52,
		101, 53, 50, 48, 101, 51, 48, 51, 51, 48, 102, 51, 51, 52, 56, 48, 101, 55, 97, 100, 99,
		57, 100, 55, 99, 56, 49, 101, 50, 48, 55, 48, 51, 49, 52, 50, 98, 102, 48, 48, 99, 53, 50,
		56, 97, 56, 48, 98, 52, 54, 51, 51, 56, 49, 102, 100, 54, 48, 50, 97, 56, 50, 99, 55, 48,
		51, 53, 50, 56, 49, 97, 97, 101, 53, 57, 53, 54, 50, 99, 99, 98, 53, 51, 51, 52, 101, 97,
		56, 57, 48, 51, 101, 54, 53, 48, 98, 48, 49, 48, 54, 56, 49, 102, 53, 99, 101, 56, 101, 98,
		54, 50, 101, 97, 99, 57, 99, 52, 49, 52, 57, 56, 56, 50, 52, 51, 97, 101, 99, 57, 50, 102,
		50, 53, 98, 102, 49, 51, 99, 100, 102, 102, 55, 101, 98, 99, 99, 50, 57, 56, 101, 101, 53,
		49, 98, 98, 97, 53, 97, 51, 53, 51, 56, 98, 54, 54, 98, 50, 54, 99, 98, 99, 52, 53, 97, 53,
		49, 100, 101, 48, 48, 51, 99, 97, 100, 51, 48, 54, 53, 51, 49, 97, 100, 55, 99, 102, 53,
		100, 52, 101, 102, 48, 102, 56, 56, 48, 53, 100, 49, 98, 57, 49, 51, 51, 100, 50, 52, 49,
		51, 53, 97, 98, 51, 99, 52, 54, 52, 49, 97, 50, 102, 56, 56, 48, 56, 51, 52, 57, 100, 55,
		51, 51, 51, 50, 57, 53, 101, 48, 101, 55, 54, 101, 101, 52, 98, 99, 53, 50, 50, 55, 50, 51,
		50, 54, 50, 56, 101, 102, 97, 56, 48, 100, 55, 57, 100, 57, 50, 97, 98, 52, 101, 51, 100,
		49, 49, 50, 48, 102, 51, 102, 98, 53, 97, 100, 49, 49, 57, 99, 100, 56, 100, 53, 52, 52,
		97, 97, 49, 100, 52, 97, 54, 56, 54, 53, 101, 54, 98, 53, 55, 98, 101, 97, 99, 53, 55, 55,
		49, 51, 48, 55, 101, 50, 101, 51, 99, 98, 57, 48, 55, 48, 100, 97, 52, 55, 98, 52, 98, 102,
		99, 56, 56, 54, 57, 101, 48, 49, 52, 49, 51, 101, 97, 48, 57, 51, 53, 52, 49, 100, 101, 56,
		97, 55, 57, 50, 56, 49, 49, 98, 55, 52, 54, 51, 54, 99, 53, 101, 57, 49, 52, 53, 50, 99,
		102, 48, 99, 101, 101, 53, 57, 102, 50, 102, 98, 52, 48, 52, 97, 99, 100, 48, 98, 99, 53,
		56, 52, 99, 98, 57, 99, 56, 51, 53, 52, 48, 52, 55, 51, 52, 99, 48, 101, 55, 101, 99, 54,
		54, 48, 53, 99, 100, 102, 99, 102, 50, 102, 102, 52, 51, 57, 98, 54, 100, 52, 55, 49, 57,
		102, 55, 48, 50, 102, 48, 101, 48, 99, 51, 102, 97, 48, 52, 102, 100, 98, 49, 50, 97, 54,
		99, 98, 50, 97, 100, 49, 97, 98, 49, 99, 57, 97, 102, 49, 102, 56, 102, 52, 99, 51, 97, 48,
		56, 101, 100, 100, 55, 50, 97, 51, 50, 98, 48, 98, 98, 53, 100, 48, 97, 100, 50, 53, 54,
		102, 102, 100, 49, 53, 57, 97, 54, 56, 51, 98, 50, 97, 53, 97, 49, 102, 49, 100, 49, 49,
		102, 97, 54, 50, 53, 51, 50, 102, 48, 51, 100, 55, 53, 52, 99, 97, 101, 102, 48, 100, 97,
		53, 55, 51, 53, 97, 49, 101, 53, 97, 56, 56, 52, 99, 55, 101, 56, 57, 100, 57, 49, 50, 49,
		56, 99, 57, 100, 55, 48, 10, 6, 8, 42, 134, 72, 206, 61, 4, 3, 2, 3, 72, 0, 48, 69, 2, 32,
		29, 18, 169, 94, 193, 177, 244, 91, 175, 2, 74, 5, 54, 234, 149, 49, 123, 68, 22, 168, 69,
		151, 8, 65, 78, 239, 217, 88, 68, 219, 81, 52, 2, 33, 0, 166, 44, 166, 191, 114, 6, 75, 8,
		68, 45, 52, 71, 155, 135, 133, 7, 189, 166, 210, 246, 140, 209, 46, 179, 115, 247, 195, 70,
		104, 52, 51, 150,
	];
	let rec_report = [
		48, 130, 12, 199, 48, 130, 12, 108, 160, 3, 2, 1, 2, 2, 1, 1, 48, 10, 6, 8, 42, 134, 72,
		206, 61, 4, 3, 2, 48, 19, 49, 17, 48, 15, 6, 3, 85, 4, 3, 12, 8, 80, 79, 76, 75, 65, 68,
		69, 88, 48, 30, 23, 13, 50, 50, 48, 57, 50, 55, 48, 57, 48, 53, 53, 51, 90, 23, 13, 50, 50,
		48, 57, 50, 56, 48, 57, 48, 53, 53, 51, 90, 48, 31, 49, 29, 48, 27, 6, 3, 85, 4, 3, 12, 20,
		80, 79, 76, 75, 65, 68, 69, 88, 32, 97, 116, 116, 101, 115, 116, 97, 116, 105, 111, 110,
		48, 89, 48, 19, 6, 7, 42, 134, 72, 206, 61, 2, 1, 6, 8, 42, 134, 72, 206, 61, 3, 1, 7, 3,
		66, 0, 4, 206, 143, 144, 158, 185, 155, 17, 86, 236, 65, 0, 35, 208, 130, 85, 20, 110, 38,
		26, 3, 207, 2, 81, 240, 108, 230, 125, 68, 207, 197, 139, 176, 133, 144, 77, 12, 110, 69,
		65, 159, 101, 170, 216, 234, 141, 233, 48, 38, 165, 63, 31, 111, 229, 205, 54, 238, 91, 36,
		227, 77, 201, 72, 84, 60, 163, 130, 11, 163, 48, 130, 11, 159, 48, 130, 11, 155, 6, 9, 96,
		134, 72, 1, 134, 248, 66, 1, 13, 4, 130, 11, 140, 123, 34, 105, 100, 34, 58, 34, 49, 54,
		54, 52, 54, 49, 51, 54, 57, 54, 53, 57, 51, 54, 53, 52, 54, 53, 54, 55, 51, 50, 52, 57, 49,
		56, 49, 57, 57, 52, 51, 53, 55, 52, 48, 54, 57, 52, 57, 34, 44, 34, 116, 105, 109, 101,
		115, 116, 97, 109, 112, 34, 58, 34, 50, 48, 50, 50, 45, 48, 57, 45, 50, 55, 84, 48, 57, 58,
		48, 53, 58, 53, 50, 46, 57, 56, 57, 55, 52, 49, 34, 44, 34, 118, 101, 114, 115, 105, 111,
		110, 34, 58, 52, 44, 34, 101, 112, 105, 100, 80, 115, 101, 117, 100, 111, 110, 121, 109,
		34, 58, 34, 56, 85, 117, 72, 68, 108, 89, 100, 52, 78, 53, 119, 113, 112, 84, 79, 99, 69,
		98, 87, 79, 87, 54, 48, 82, 101, 84, 99, 118, 106, 107, 76, 88, 80, 53, 120, 85, 69, 115,
		121, 88, 84, 84, 115, 81, 65, 119, 114, 66, 68, 70, 67, 119, 110, 100, 52, 50, 111, 116,
		108, 86, 79, 106, 67, 106, 107, 76, 52, 80, 112, 56, 83, 87, 83, 57, 69, 111, 74, 47, 49,
		66, 108, 56, 77, 66, 53, 65, 119, 111, 115, 114, 86, 66, 122, 107, 108, 102, 90, 82, 114,
		43, 54, 84, 113, 43, 67, 97, 65, 114, 82, 49, 109, 83, 81, 71, 111, 88, 104, 71, 83, 120,
		99, 52, 113, 73, 52, 86, 67, 102, 120, 80, 88, 101, 79, 76, 73, 79, 72, 111, 97, 65, 55,
		104, 56, 88, 73, 70, 113, 122, 118, 81, 66, 48, 112, 70, 108, 52, 70, 70, 87, 70, 101, 81,
		108, 99, 73, 107, 86, 74, 80, 85, 61, 34, 44, 34, 97, 100, 118, 105, 115, 111, 114, 121,
		85, 82, 76, 34, 58, 34, 104, 116, 116, 112, 115, 58, 47, 47, 115, 101, 99, 117, 114, 105,
		116, 121, 45, 99, 101, 110, 116, 101, 114, 46, 105, 110, 116, 101, 108, 46, 99, 111, 109,
		34, 44, 34, 97, 100, 118, 105, 115, 111, 114, 121, 73, 68, 115, 34, 58, 91, 34, 73, 78, 84,
		69, 76, 45, 83, 65, 45, 48, 48, 51, 51, 52, 34, 93, 44, 34, 105, 115, 118, 69, 110, 99,
		108, 97, 118, 101, 81, 117, 111, 116, 101, 83, 116, 97, 116, 117, 115, 34, 58, 34, 83, 87,
		95, 72, 65, 82, 68, 69, 78, 73, 78, 71, 95, 78, 69, 69, 68, 69, 68, 34, 44, 34, 105, 115,
		118, 69, 110, 99, 108, 97, 118, 101, 81, 117, 111, 116, 101, 66, 111, 100, 121, 34, 58, 34,
		65, 103, 65, 66, 65, 69, 115, 77, 65, 65, 65, 78, 65, 65, 48, 65, 65, 65, 65, 65, 65, 80,
		111, 47, 52, 109, 114, 89, 54, 71, 65, 53, 72, 120, 121, 107, 76, 48, 109, 83, 69, 57, 111,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 69,
		120, 77, 67, 66, 47, 43, 65, 66, 103, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 66, 119, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 72, 65, 65, 65, 65, 65, 65, 65, 65, 65, 75, 75, 48, 111, 109,
		83, 117, 107, 112, 66, 77, 80, 106, 116, 86, 109, 52, 116, 105, 120, 101, 108, 111, 50,
		110, 114, 79, 119, 86, 85, 47, 73, 107, 78, 66, 55, 73, 68, 122, 97, 56, 114, 68, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 66, 102, 116, 52, 48,
		53, 83, 50, 87, 86, 57, 108, 88, 106, 50, 48, 99, 79, 106, 52, 57, 80, 65, 116, 70, 47,
		112, 88, 88, 79, 117, 85, 108, 82, 53, 65, 72, 104, 108, 110, 84, 121, 74, 103, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 75, 69, 86, 67, 69, 65, 82, 56, 110, 77, 86, 80, 112, 53, 86, 99, 97, 112, 75,
		56, 86, 55, 121, 113, 84, 84, 79, 56, 49, 105, 82, 76, 90, 78, 100, 69, 115, 100, 107, 68,
		98, 98, 81, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65,
		65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 65, 34,
		125, 124, 105, 76, 76, 65, 114, 108, 79, 117, 86, 56, 70, 84, 55, 113, 48, 110, 99, 54, 80,
		116, 108, 47, 87, 88, 100, 54, 76, 121, 100, 122, 122, 104, 117, 71, 48, 82, 102, 73, 72,
		79, 66, 49, 108, 56, 69, 109, 98, 120, 99, 103, 99, 84, 110, 82, 114, 112, 51, 113, 120,
		57, 85, 90, 105, 49, 118, 43, 107, 70, 47, 85, 67, 102, 48, 84, 106, 113, 100, 43, 82, 48,
		57, 109, 102, 108, 79, 43, 112, 116, 110, 98, 120, 47, 113, 51, 73, 43, 57, 76, 43, 113,
		83, 54, 106, 85, 120, 48, 67, 115, 102, 70, 110, 117, 114, 122, 97, 57, 97, 120, 50, 79,
		80, 102, 104, 113, 99, 84, 110, 49, 74, 84, 70, 77, 117, 73, 115, 89, 109, 67, 99, 71, 70,
		73, 114, 66, 103, 108, 117, 70, 65, 48, 107, 112, 49, 79, 118, 83, 57, 84, 108, 103, 56,
		98, 87, 100, 57, 88, 87, 65, 54, 106, 67, 51, 83, 54, 55, 86, 121, 52, 116, 49, 55, 100,
		88, 76, 79, 69, 118, 49, 53, 111, 110, 52, 69, 56, 51, 86, 56, 103, 48, 88, 108, 99, 78,
		78, 90, 66, 85, 69, 80, 119, 50, 48, 85, 70, 48, 65, 47, 118, 51, 115, 121, 66, 71, 48, 71,
		89, 118, 105, 118, 122, 75, 109, 70, 80, 85, 65, 75, 72, 113, 115, 77, 56, 114, 117, 104,
		98, 67, 120, 102, 78, 55, 103, 57, 85, 48, 116, 120, 112, 112, 88, 57, 106, 49, 81, 54,
		117, 51, 115, 115, 86, 85, 69, 85, 105, 104, 53, 82, 43, 105, 83, 70, 70, 89, 111, 49, 98,
		100, 100, 113, 65, 98, 50, 102, 111, 80, 74, 52, 103, 114, 78, 48, 107, 84, 114, 82, 114,
		79, 72, 49, 57, 114, 75, 72, 78, 69, 88, 114, 55, 78, 119, 70, 52, 75, 53, 79, 81, 103, 84,
		71, 112, 78, 56, 55, 87, 52, 108, 87, 48, 53, 47, 97, 119, 61, 61, 124, 77, 73, 73, 69,
		111, 84, 67, 67, 65, 119, 109, 103, 65, 119, 73, 66, 65, 103, 73, 74, 65, 78, 69, 72, 100,
		108, 48, 121, 111, 55, 67, 87, 77, 65, 48, 71, 67, 83, 113, 71, 83, 73, 98, 51, 68, 81, 69,
		66, 67, 119, 85, 65, 77, 72, 52, 120, 67, 122, 65, 74, 66, 103, 78, 86, 66, 65, 89, 84, 65,
		108, 86, 84, 77, 81, 115, 119, 67, 81, 89, 68, 86, 81, 81, 73, 68, 65, 74, 68, 81, 84, 69,
		85, 77, 66, 73, 71, 65, 49, 85, 69, 66, 119, 119, 76, 85, 50, 70, 117, 100, 71, 69, 103,
		81, 50, 120, 104, 99, 109, 69, 120, 71, 106, 65, 89, 66, 103, 78, 86, 66, 65, 111, 77, 69,
		85, 108, 117, 100, 71, 86, 115, 73, 69, 78, 118, 99, 110, 66, 118, 99, 109, 70, 48, 97, 87,
		57, 117, 77, 84, 65, 119, 76, 103, 89, 68, 86, 81, 81, 68, 68, 67, 100, 74, 98, 110, 82,
		108, 98, 67, 66, 84, 82, 49, 103, 103, 81, 88, 82, 48, 90, 88, 78, 48, 89, 88, 82, 112, 98,
		50, 52, 103, 85, 109, 86, 119, 98, 51, 74, 48, 73, 70, 78, 112, 90, 50, 53, 112, 98, 109,
		99, 103, 81, 48, 69, 119, 72, 104, 99, 78, 77, 84, 89, 120, 77, 84, 73, 121, 77, 68, 107,
		122, 78, 106, 85, 52, 87, 104, 99, 78, 77, 106, 89, 120, 77, 84, 73, 119, 77, 68, 107, 122,
		78, 106, 85, 52, 87, 106, 66, 55, 77, 81, 115, 119, 67, 81, 89, 68, 86, 81, 81, 71, 69,
		119, 74, 86, 85, 122, 69, 76, 77, 65, 107, 71, 65, 49, 85, 69, 67, 65, 119, 67, 81, 48, 69,
		120, 70, 68, 65, 83, 66, 103, 78, 86, 66, 65, 99, 77, 67, 49, 78, 104, 98, 110, 82, 104,
		73, 69, 78, 115, 89, 88, 74, 104, 77, 82, 111, 119, 71, 65, 89, 68, 86, 81, 81, 75, 68, 66,
		70, 74, 98, 110, 82, 108, 98, 67, 66, 68, 98, 51, 74, 119, 98, 51, 74, 104, 100, 71, 108,
		118, 98, 106, 69, 116, 77, 67, 115, 71, 65, 49, 85, 69, 65, 119, 119, 107, 83, 87, 53, 48,
		90, 87, 119, 103, 85, 48, 100, 89, 73, 69, 70, 48, 100, 71, 86, 122, 100, 71, 70, 48, 97,
		87, 57, 117, 73, 70, 74, 108, 99, 71, 57, 121, 100, 67, 66, 84, 97, 87, 100, 117, 97, 87,
		53, 110, 77, 73, 73, 66, 73, 106, 65, 78, 66, 103, 107, 113, 104, 107, 105, 71, 57, 119,
		48, 66, 65, 81, 69, 70, 65, 65, 79, 67, 65, 81, 56, 65, 77, 73, 73, 66, 67, 103, 75, 67,
		65, 81, 69, 65, 113, 88, 111, 116, 52, 79, 90, 117, 112, 104, 82, 56, 110, 117, 100, 70,
		114, 65, 70, 105, 97, 71, 120, 120, 107, 103, 109, 97, 47, 69, 115, 47, 66, 65, 43, 116,
		98, 101, 67, 84, 85, 82, 49, 48, 54, 65, 76, 49, 69, 78, 99, 87, 65, 52, 70, 88, 51, 75,
		43, 69, 57, 66, 66, 76, 48, 47, 55, 88, 53, 114, 106, 53, 110, 73, 103, 88, 47, 82, 47, 49,
		117, 98, 104, 107, 75, 87, 119, 57, 103, 102, 113, 80, 71, 51, 75, 101, 65, 116, 73, 100,
		99, 118, 47, 117, 84, 79, 49, 121, 88, 118, 53, 48, 118, 113, 97, 80, 118, 69, 49, 67, 82,
		67, 104, 118, 122, 100, 83, 47, 90, 69, 66, 113, 81, 53, 111, 86, 118, 76, 84, 80, 90, 51,
		86, 69, 105, 99, 81, 106, 108, 121, 116, 75, 103, 78, 57, 99, 76, 110, 120, 98, 119, 116,
		117, 118, 76, 85, 75, 55, 101, 121, 82, 80, 102, 74, 87, 47, 107, 115, 100, 100, 79, 122,
		80, 56, 86, 66, 66, 110, 105, 111, 108, 89, 110, 82, 67, 68, 50, 106, 114, 77, 82, 90, 56,
		110, 66, 77, 50, 90, 87, 89, 119, 110, 88, 110, 119, 89, 101, 79, 65, 72, 86, 43, 87, 57,
		116, 79, 104, 65, 73, 109, 119, 82, 119, 75, 70, 47, 57, 53, 121, 65, 115, 86, 119, 100,
		50, 49, 114, 121, 72, 77, 74, 66, 99, 71, 72, 55, 48, 113, 76, 97, 103, 90, 55, 84, 116,
		121, 116, 43, 43, 113, 79, 47, 54, 43, 75, 65, 88, 74, 117, 75, 119, 90, 113, 106, 82, 108,
		69, 116, 83, 69, 122, 56, 103, 90, 81, 101, 70, 102, 86, 89, 103, 99, 119, 83, 102, 111,
		57, 54, 111, 83, 77, 65, 122, 86, 114, 55, 86, 48, 76, 54, 72, 83, 68, 76, 82, 110, 112,
		98, 54, 120, 120, 109, 98, 80, 100, 113, 78, 111, 108, 52, 116, 81, 73, 68, 65, 81, 65, 66,
		111, 52, 71, 107, 77, 73, 71, 104, 77, 66, 56, 71, 65, 49, 85, 100, 73, 119, 81, 89, 77,
		66, 97, 65, 70, 72, 104, 68, 101, 51, 97, 109, 102, 114, 122, 81, 114, 51, 53, 67, 78, 43,
		115, 49, 102, 68, 117, 72, 65, 86, 69, 56, 77, 65, 52, 71, 65, 49, 85, 100, 68, 119, 69,
		66, 47, 119, 81, 69, 65, 119, 73, 71, 119, 68, 65, 77, 66, 103, 78, 86, 72, 82, 77, 66, 65,
		102, 56, 69, 65, 106, 65, 65, 77, 71, 65, 71, 65, 49, 85, 100, 72, 119, 82, 90, 77, 70, 99,
		119, 86, 97, 66, 84, 111, 70, 71, 71, 84, 50, 104, 48, 100, 72, 65, 54, 76, 121, 57, 48,
		99, 110, 86, 122, 100, 71, 86, 107, 99, 50, 86, 121, 100, 109, 108, 106, 90, 88, 77, 117,
		97, 87, 53, 48, 90, 87, 119, 117, 89, 50, 57, 116, 76, 50, 78, 118, 98, 110, 82, 108, 98,
		110, 81, 118, 81, 49, 74, 77, 76, 49, 78, 72, 87, 67, 57, 66, 100, 72, 82, 108, 99, 51, 82,
		104, 100, 71, 108, 118, 98, 108, 74, 108, 99, 71, 57, 121, 100, 70, 78, 112, 90, 50, 53,
		112, 98, 109, 100, 68, 81, 83, 53, 106, 99, 109, 119, 119, 68, 81, 89, 74, 75, 111, 90, 73,
		104, 118, 99, 78, 65, 81, 69, 76, 66, 81, 65, 68, 103, 103, 71, 66, 65, 71, 99, 73, 116,
		104, 116, 99, 75, 57, 73, 86, 82, 122, 52, 114, 82, 113, 43, 90, 75, 69, 43, 55, 107, 53,
		48, 47, 79, 120, 85, 115, 109, 87, 56, 97, 97, 118, 79, 122, 75, 98, 48, 105, 67, 120, 48,
		55, 89, 81, 57, 114, 122, 105, 53, 110, 85, 55, 51, 116, 77, 69, 50, 121, 71, 82, 76, 122,
		104, 83, 86, 105, 70, 115, 47, 76, 112, 70, 97, 57, 108, 112, 81, 76, 54, 74, 76, 49, 97,
		81, 119, 109, 68, 82, 55, 52, 84, 120, 89, 71, 66, 65, 73, 105, 53, 102, 52, 73, 53, 84,
		74, 111, 67, 67, 69, 113, 82, 72, 122, 57, 49, 107, 112, 71, 54, 85, 118, 121, 110, 50,
		116, 76, 109, 110, 73, 100, 74, 98, 80, 69, 52, 118, 89, 118, 87, 76, 114, 116, 88, 88,
		102, 70, 66, 83, 83, 80, 68, 52, 65, 102, 110, 55, 43, 51, 47, 88, 85, 103, 103, 65, 108,
		99, 55, 111, 67, 84, 105, 122, 79, 102, 98, 98, 116, 79, 70, 108, 89, 65, 52, 103, 53, 75,
		99, 89, 103, 83, 49, 74, 50, 90, 65, 101, 77, 81, 113, 98, 85, 100, 90, 115, 101, 90, 67,
		99, 97, 90, 90, 90, 110, 54, 53, 116, 100, 113, 101, 101, 56, 85, 88, 90, 108, 68, 118,
		120, 48, 43, 78, 100, 79, 48, 76, 82, 43, 53, 112, 70, 121, 43, 106, 117, 77, 48, 119, 87,
		98, 117, 53, 57, 77, 118, 122, 99, 109, 84, 88, 98, 106, 115, 105, 55, 72, 89, 54, 122,
		100, 53, 51, 89, 113, 53, 75, 50, 52, 52, 102, 119, 70, 72, 82, 81, 56, 101, 79, 66, 48,
		73, 87, 66, 43, 52, 80, 102, 77, 55, 70, 101, 65, 65, 112, 90, 118, 108, 102, 113, 108, 75,
		79, 108, 76, 99, 90, 76, 50, 117, 121, 86, 109, 122, 82, 107, 121, 82, 53, 121, 87, 55, 50,
		117, 111, 57, 109, 101, 104, 88, 52, 52, 67, 105, 80, 74, 50, 102, 115, 101, 57, 89, 54,
		101, 81, 116, 99, 102, 69, 104, 77, 80, 107, 109, 72, 88, 73, 48, 49, 115, 78, 43, 75, 119,
		80, 98, 112, 65, 51, 57, 43, 120, 79, 115, 83, 116, 106, 104, 80, 57, 78, 49, 89, 49, 97,
		50, 116, 81, 65, 86, 111, 43, 121, 86, 103, 76, 103, 86, 50, 72, 119, 115, 55, 51, 70, 99,
		48, 111, 51, 119, 67, 55, 56, 113, 80, 69, 65, 43, 118, 50, 97, 82, 115, 47, 66, 101, 51,
		90, 70, 68, 103, 68, 121, 103, 104, 99, 47, 49, 102, 103, 85, 43, 55, 67, 43, 80, 54, 107,
		98, 113, 100, 52, 112, 111, 121, 98, 54, 73, 87, 56, 75, 67, 74, 98, 120, 102, 77, 74, 118,
		107, 111, 114, 100, 78, 79, 103, 79, 85, 85, 120, 110, 100, 80, 72, 69, 105, 47, 116, 98,
		47, 85, 55, 117, 76, 106, 76, 79, 103, 80, 65, 61, 61, 48, 10, 6, 8, 42, 134, 72, 206, 61,
		4, 3, 2, 3, 73, 0, 48, 70, 2, 33, 0, 151, 190, 124, 83, 232, 70, 138, 96, 137, 23, 222,
		155, 76, 21, 100, 118, 226, 93, 173, 121, 241, 189, 149, 239, 136, 133, 201, 217, 171, 98,
		214, 147, 2, 33, 0, 163, 22, 24, 224, 191, 61, 191, 75, 175, 71, 103, 44, 15, 92, 3, 32,
		128, 89, 205, 202, 125, 93, 67, 221, 65, 203, 248, 150, 81, 31, 48, 243,
	];
	//let r_result = verify_ias_report(&report);
	let rec_result = verify_ias_report(&rec_report);

	//assert!(r_result.is_err());
	match rec_result {
		Ok(_) => (),
		Err(e) => {
			println!("{}", e.to_string());
			panic!("{}", e.to_string());
		},
	}
}

#[test]
fn test_register_main_account() {
	let account_id = create_account_id();

	new_test_ext().execute_with(|| {
		assert_eq!(Accounts::<Test>::contains_key::<AccountId32>(account_id.clone().into()), false);
		assert_ok!(OCEX::register_main_account(
			Origin::signed(account_id.clone().into()),
			account_id.clone().into()
		));
		assert_eq!(Accounts::<Test>::contains_key::<AccountId32>(account_id.clone().into()), true);
		let account_info = Accounts::<Test>::get(account_id.clone()).unwrap();
		assert_eq!(account_info.proxies.len(), 1);
		assert_eq!(account_info.proxies[0], account_id.clone());
		assert_last_event::<Test>(
			crate::Event::MainAccountRegistered {
				main: account_id.clone(),
				proxy: account_id.clone(),
			}
			.into(),
		);
		let event: IngressMessages<AccountId32> =
			IngressMessages::RegisterUser(account_id.clone(), account_id.clone());
		assert_eq!(OCEX::ingress_messages()[0], event);
	});
}

#[test]
fn test_register_main_account_main_account_already_exists() {
	let account_id = create_account_id();

	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_main_account(
			Origin::signed(account_id.clone().into()),
			account_id.clone().into()
		));
		assert_eq!(Accounts::<Test>::contains_key::<AccountId32>(account_id.clone().into()), true);
		assert_noop!(
			OCEX::register_main_account(
				Origin::signed(account_id.clone().into()),
				account_id.clone().into()
			),
			Error::<Test>::MainAccountAlreadyRegistered
		);
	});
}

#[test]
fn test_register_main_account_bad_origin() {
	let account_id = create_account_id();

	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::register_main_account(Origin::root(), account_id.clone().into()),
			BadOrigin
		);
		assert_noop!(
			OCEX::register_main_account(Origin::none(), account_id.clone().into()),
			BadOrigin
		);
	});
}

#[test]
fn test_add_proxy_account_main_account_not_found() {
	let account_id = create_account_id();

	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::add_proxy_account(Origin::signed(account_id.clone().into()), account_id.into()),
			Error::<Test>::MainAccountNotFound
		);
	});
}

#[test]
fn test_add_proxy_account_proxy_limit_exceeded() {
	let account_id = create_account_id();
	let proxy_account = create_proxy_account();
	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_main_account(
			Origin::signed(account_id.clone().into()),
			account_id.clone().into()
		));
		assert_ok!(OCEX::add_proxy_account(
			Origin::signed(account_id.clone().into()),
			account_id.clone().into()
		));
		assert_ok!(OCEX::add_proxy_account(
			Origin::signed(account_id.clone().into()),
			account_id.clone().into()
		));
		assert_noop!(
			OCEX::add_proxy_account(
				Origin::signed(account_id.clone().into()),
				proxy_account.clone().into()
			),
			Error::<Test>::ProxyLimitExceeded
		);
	})
}

#[test]
fn test_add_proxy_account_bad_origin() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		assert_noop!(OCEX::add_proxy_account(Origin::root(), account_id.clone().into()), BadOrigin);

		assert_noop!(OCEX::add_proxy_account(Origin::none(), account_id.clone().into()), BadOrigin);
	});
}

#[test]
fn test_add_proxy_account() {
	let account_id = create_account_id();

	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_main_account(
			Origin::signed(account_id.clone().into()),
			account_id.clone().into()
		));
		assert_ok!(OCEX::add_proxy_account(
			Origin::signed(account_id.clone().into()),
			account_id.clone().into()
		));
		assert_last_event::<Test>(
			crate::Event::MainAccountRegistered {
				main: account_id.clone(),
				proxy: account_id.clone(),
			}
			.into(),
		);
		let event: IngressMessages<AccountId32> =
			IngressMessages::AddProxy(account_id.clone(), account_id.clone());
		assert_eq!(OCEX::ingress_messages()[1], event);
	});
}

#[test]
fn test_register_trading_pair_both_assets_cannot_be_same() {
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::polkadex,
				AssetId::polkadex,
				1_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into(),
			),
			Error::<Test>::BothAssetsCannotBeSame
		);
	});
}

#[test]
fn test_register_trading_pair_bad_origin() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::register_trading_pair(
				Origin::none(),
				AssetId::polkadex,
				AssetId::polkadex,
				1_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into(),
			),
			BadOrigin
		);

		assert_noop!(
			OCEX::register_trading_pair(
				Origin::signed(account_id.into()),
				AssetId::polkadex,
				AssetId::polkadex,
				1_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into(),
			),
			BadOrigin
		);
	});
}

#[test]
fn test_register_trading_pair_value_zero() {
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				0_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into(),
			),
			Error::<Test>::TradingPairConfigCannotBeZero
		);
	});
}

#[test]
fn test_register_trading_pair() {
	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_trading_pair(
			Origin::root(),
			AssetId::asset(10),
			AssetId::asset(20),
			1_u128.into(),
			100_u128.into(),
			1_u128.into(),
			100_u128.into(),
			100_u128.into(),
			10_u128.into()
		));

		assert_eq!(
			TradingPairs::<Test>::contains_key(AssetId::asset(10), AssetId::asset(20)),
			true
		);
		assert_eq!(
			TradingPairs::<Test>::get(AssetId::asset(10), AssetId::asset(20))
				.unwrap()
				.operational_status,
			true
		);
		assert_last_event::<Test>(
			crate::Event::TradingPairRegistered {
				base: AssetId::asset(10),
				quote: AssetId::asset(20),
			}
			.into(),
		);
		let trading_pair =
			TradingPairs::<Test>::get(AssetId::asset(10), AssetId::asset(20)).unwrap();
		let event: IngressMessages<AccountId32> = IngressMessages::OpenTradingPair(trading_pair);
		assert_eq!(OCEX::ingress_messages()[0], event);
	});
}

#[test]
fn test_register_trading_pair_amount_overflow() {
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				DEPOSIT_MAX + 1,
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				DEPOSIT_MAX + 1,
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				100_u128.into(),
				DEPOSIT_MAX + 1,
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				100_u128.into(),
				1_u128.into(),
				DEPOSIT_MAX + 1,
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				DEPOSIT_MAX + 1,
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				DEPOSIT_MAX + 1
			),
			Error::<Test>::AmountOverflow
		);
	});
}

#[test]
fn test_update_trading_pair_amount_overflow() {
	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_trading_pair(
			Origin::root(),
			AssetId::asset(10),
			AssetId::asset(20),
			100_u128.into(),
			100_u128.into(),
			1_u128.into(),
			100_u128.into(),
			100_u128.into(),
			10_u128.into()
		));

		assert_noop!(
			OCEX::update_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				DEPOSIT_MAX + 1,
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::update_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				DEPOSIT_MAX + 1,
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::update_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				100_u128.into(),
				DEPOSIT_MAX + 1,
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::update_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				100_u128.into(),
				1_u128.into(),
				DEPOSIT_MAX + 1,
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::update_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				DEPOSIT_MAX + 1,
				10_u128.into()
			),
			Error::<Test>::AmountOverflow
		);

		assert_noop!(
			OCEX::update_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				100_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				DEPOSIT_MAX + 1
			),
			Error::<Test>::AmountOverflow
		);
	});
}

#[test]
fn test_register_trading_pair_trading_pair_already_registered() {
	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_trading_pair(
			Origin::root(),
			AssetId::asset(10),
			AssetId::asset(20),
			1_u128.into(),
			100_u128.into(),
			1_u128.into(),
			100_u128.into(),
			100_u128.into(),
			10_u128.into()
		));

		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				1_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::TradingPairAlreadyRegistered
		);

		assert_noop!(
			OCEX::register_trading_pair(
				Origin::root(),
				AssetId::asset(20),
				AssetId::asset(10),
				1_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::TradingPairAlreadyRegistered
		);
	});
}

#[test]
fn test_update_trading_pair() {
	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_trading_pair(
			Origin::root(),
			AssetId::asset(10),
			AssetId::asset(20),
			1_u128.into(),
			100_u128.into(),
			1_u128.into(),
			100_u128.into(),
			100_u128.into(),
			10_u128.into()
		));

		assert_ok!(OCEX::update_trading_pair(
			Origin::root(),
			AssetId::asset(10),
			AssetId::asset(20),
			1_u128.into(),
			100_u128.into(),
			1_u128.into(),
			100_u128.into(),
			100_u128.into(),
			10_u128.into()
		));

		assert_last_event::<Test>(
			crate::Event::TradingPairUpdated {
				base: AssetId::asset(10),
				quote: AssetId::asset(20),
			}
			.into(),
		);
		let trading_pair =
			TradingPairs::<Test>::get(AssetId::asset(10), AssetId::asset(20)).unwrap();
		let event: IngressMessages<AccountId32> = IngressMessages::UpdateTradingPair(trading_pair);
		assert_eq!(OCEX::ingress_messages()[1], event);
	});
}

#[test]
fn test_update_trading_pair_trading_pair_not_registered() {
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::update_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				1_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			Error::<Test>::TradingPairNotRegistered
		);
	});
}

#[test]
fn test_update_trading_pair_bad_origin() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::update_trading_pair(
				Origin::none(),
				AssetId::asset(10),
				AssetId::asset(20),
				1_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			BadOrigin
		);
		assert_noop!(
			OCEX::update_trading_pair(
				Origin::signed(account_id.into()),
				AssetId::asset(10),
				AssetId::asset(20),
				1_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into()
			),
			BadOrigin
		);
	});
}

#[test]
fn test_update_trading_pair_value_zero() {
	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_trading_pair(
			Origin::root(),
			AssetId::asset(10),
			AssetId::asset(20),
			1_u128.into(),
			100_u128.into(),
			1_u128.into(),
			100_u128.into(),
			100_u128.into(),
			10_u128.into()
		));

		assert_noop!(
			OCEX::update_trading_pair(
				Origin::root(),
				AssetId::asset(10),
				AssetId::asset(20),
				0_u128.into(),
				100_u128.into(),
				1_u128.into(),
				100_u128.into(),
				100_u128.into(),
				10_u128.into(),
			),
			Error::<Test>::TradingPairConfigCannotBeZero
		);
	});
}

#[test]
fn test_deposit_unknown_asset() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::deposit(
				Origin::signed(account_id.clone().into()),
				AssetId::asset(10),
				100_u128.into()
			),
			TokenError::UnknownAsset
		);
	});
}

#[test]
fn test_deposit_bad_origin() {
	new_test_ext().execute_with(|| {
		assert_noop!(OCEX::deposit(Origin::root(), AssetId::asset(10), 100_u128.into()), BadOrigin);

		assert_noop!(OCEX::deposit(Origin::none(), AssetId::asset(10), 100_u128.into()), BadOrigin);
	});
}

#[test]
fn test_deposit() {
	let account_id = create_account_id();
	let custodian_account = OCEX::get_custodian_account();
	new_test_ext().execute_with(|| {
		mint_into_account(account_id.clone());
		// Balances before deposit
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(account_id.clone()),
			10000000000000000000000
		);
		assert_eq!(<Test as Config>::NativeCurrency::free_balance(custodian_account.clone()), 0);
		assert_ok!(OCEX::deposit(
			Origin::signed(account_id.clone().into()),
			AssetId::polkadex,
			100_u128.into()
		));
		// Balances after deposit
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(account_id.clone()),
			9999999999999999999900
		);
		assert_eq!(<Test as Config>::NativeCurrency::free_balance(custodian_account.clone()), 100);
		assert_last_event::<Test>(
			crate::Event::DepositSuccessful {
				user: account_id.clone(),
				asset: AssetId::polkadex,
				amount: 100_u128,
			}
			.into(),
		);
		let event: IngressMessages<AccountId32> =
			IngressMessages::Deposit(account_id, AssetId::polkadex, Decimal::new(10, 11));
		assert_eq!(OCEX::ingress_messages()[0], event);
	});
}

#[test]
fn test_deposit_large_value() {
	let account_id = create_account_id();
	let custodian_account = OCEX::get_custodian_account();
	new_test_ext().execute_with(|| {
		mint_into_account_large(account_id.clone());
		// Balances before deposit
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(account_id.clone()),
			1_000_000_000_000_000_000_000_000_000_000
		);
		assert_eq!(<Test as Config>::NativeCurrency::free_balance(custodian_account.clone()), 0);
		assert_noop!(
			OCEX::deposit(
				Origin::signed(account_id.clone().into()),
				AssetId::polkadex,
				1_000_000_000_000_000_000_000_000_0000
			),
			Error::<Test>::AmountOverflow
		);
	});
}

#[test]
fn test_deposit_assets_overflow() {
	let account_id = create_account_id();
	let custodian_account = OCEX::get_custodian_account();
	new_test_ext().execute_with(|| {
		mint_into_account_large(account_id.clone());
		// Balances before deposit
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(account_id.clone()),
			1_000_000_000_000_000_000_000_000_000_000
		);
		assert_eq!(<Test as Config>::NativeCurrency::free_balance(custodian_account.clone()), 0);
		assert_ok!(OCEX::deposit(
			Origin::signed(account_id.clone().into()),
			AssetId::polkadex,
			1_000_000_000_000_000_000_000_000_000
		));
		let large_value: Decimal = Decimal::MAX;
		mint_into_account_large(account_id.clone());
		// Directly setting the storage value, found it very difficult to manually fill it up
		TotalAssets::<Test>::insert(
			AssetId::polkadex,
			large_value.saturating_sub(Decimal::from_u128(1).unwrap()),
		);

		assert_noop!(
			OCEX::deposit(
				Origin::signed(account_id.clone().into()),
				AssetId::polkadex,
				10_u128.pow(20)
			),
			Error::<Test>::AmountOverflow
		);
	});
}

#[test]
fn test_open_trading_pair_both_assets_cannot_be_same() {
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::open_trading_pair(Origin::root(), AssetId::asset(10), AssetId::asset(10)),
			Error::<Test>::BothAssetsCannotBeSame
		);

		assert_eq!(OCEX::ingress_messages().len(), 0);
	});
}

#[test]
fn test_open_trading_pair_trading_pair_not_found() {
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::open_trading_pair(Origin::root(), AssetId::asset(10), AssetId::asset(20)),
			Error::<Test>::TradingPairNotFound
		);

		assert_eq!(OCEX::ingress_messages().len(), 0);
	});
}

#[test]
fn test_open_trading_pair_bad_origin() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::open_trading_pair(Origin::none(), AssetId::asset(10), AssetId::asset(20)),
			BadOrigin
		);

		assert_noop!(
			OCEX::open_trading_pair(
				Origin::signed(account_id.into()),
				AssetId::asset(10),
				AssetId::asset(20)
			),
			BadOrigin
		);
	});
}

#[test]
fn test_open_trading_pair() {
	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_trading_pair(
			Origin::root(),
			AssetId::asset(10),
			AssetId::asset(20),
			1_u128.into(),
			100_u128.into(),
			1_u128.into(),
			100_u128.into(),
			100_u128.into(),
			10_u128.into()
		));
		assert_ok!(OCEX::open_trading_pair(Origin::root(), AssetId::asset(10), AssetId::asset(20)));
		assert_eq!(
			TradingPairs::<Test>::get(AssetId::asset(10), AssetId::asset(20))
				.unwrap()
				.operational_status,
			true
		);
		let trading_pair = OCEX::trading_pairs(AssetId::asset(10), AssetId::asset(20)).unwrap();
		assert_last_event::<Test>(
			crate::Event::OpenTradingPair { pair: trading_pair.clone() }.into(),
		);
		let event: IngressMessages<AccountId32> = IngressMessages::OpenTradingPair(trading_pair);
		assert_eq!(OCEX::ingress_messages()[0], event);
	})
}

#[test]
fn test_close_trading_pair_both_assets_cannot_be_same() {
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::close_trading_pair(Origin::root(), AssetId::asset(10), AssetId::asset(10)),
			Error::<Test>::BothAssetsCannotBeSame
		);

		assert_eq!(OCEX::ingress_messages().len(), 0);
	});
}

#[test]
fn test_close_trading_trading_pair_not_found() {
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::close_trading_pair(Origin::root(), AssetId::asset(10), AssetId::asset(20)),
			Error::<Test>::TradingPairNotFound
		);

		assert_eq!(OCEX::ingress_messages().len(), 0);
	});
}

#[test]
fn test_close_trading_trading_bad_origin() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::close_trading_pair(Origin::none(), AssetId::asset(10), AssetId::asset(20)),
			BadOrigin
		);

		assert_noop!(
			OCEX::close_trading_pair(
				Origin::signed(account_id.into()),
				AssetId::asset(10),
				AssetId::asset(20)
			),
			BadOrigin
		);
	});
}

#[test]
fn test_close_trading_pair() {
	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::register_trading_pair(
			Origin::root(),
			AssetId::asset(10),
			AssetId::asset(20),
			1_u128.into(),
			100_u128.into(),
			1_u128.into(),
			100_u128.into(),
			100_u128.into(),
			10_u128.into()
		));
		assert_ok!(OCEX::close_trading_pair(
			Origin::root(),
			AssetId::asset(10),
			AssetId::asset(20)
		));
		assert_eq!(
			TradingPairs::<Test>::get(AssetId::asset(10), AssetId::asset(20))
				.unwrap()
				.operational_status,
			false
		);
		let trading_pair = OCEX::trading_pairs(AssetId::asset(10), AssetId::asset(20)).unwrap();
		assert_last_event::<Test>(
			crate::Event::ShutdownTradingPair { pair: trading_pair.clone() }.into(),
		);
		let event: IngressMessages<AccountId32> = IngressMessages::CloseTradingPair(trading_pair);
		assert_eq!(OCEX::ingress_messages()[1], event);
	})
}

#[test]
fn collect_fees_unexpected_behaviour() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		// TODO! Discuss if this is expected behaviour, if not then could this be a potential DDOS?
		assert_ok!(OCEX::collect_fees(Origin::root(), 100, account_id.clone().into()));

		assert_last_event::<Test>(
			crate::Event::FeesClaims { beneficiary: account_id, snapshot_id: 100 }.into(),
		);
	});
}

#[test]
fn collect_fees() {
	let account_id = create_account_id();
	let custodian_account = OCEX::get_custodian_account();
	const PHRASE: &str =
		"news slush supreme milk chapter athlete soap sausage put clutch what kitten";
	let public_key_store = KeyStore::new();
	let public_key = SyncCryptoStore::sr25519_generate_new(
		&public_key_store,
		KEY_TYPE,
		Some(&format!("{}/hunter1", PHRASE)),
	)
	.expect("Unable to create sr25519 key pair");
	let mut t = new_test_ext();
	t.register_extension(KeystoreExt(Arc::new(public_key_store)));
	t.execute_with(|| {
		mint_into_account(account_id.clone());
		mint_into_account(custodian_account.clone());
		// Initial Balances
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(account_id.clone()),
			10000000000000000000000
		);
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(custodian_account.clone()),
			10000000000000000000000
		);
		let fees = create_fees::<Test>();

		let snapshot =
			EnclaveSnapshot::<AccountId32, WithdrawalLimit, AssetsLimit, SnapshotAccLimit> {
				snapshot_number: 1,
				snapshot_hash: H256::random(),
				withdrawals: Default::default(),
				fees: bounded_vec![fees],
			};
		assert_ok!(OCEX::insert_enclave(Origin::root(), account_id.clone().into()));
		let bytes = snapshot.encode();
		let signature = public_key.sign(KEY_TYPE, &bytes).unwrap();

		assert_ok!(OCEX::submit_snapshot(
			Origin::signed(account_id.clone().into()),
			snapshot,
			signature.clone().into()
		),);

		assert_ok!(OCEX::collect_fees(Origin::root(), 1, account_id.clone().into()));
		// Balances after collect fees
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(account_id.clone()),
			10000000010000000000000
		);
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(custodian_account.clone()),
			9999999990000000000000
		);
	});
}

#[test]
fn test_collect_fees_bad_origin() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::collect_fees(Origin::signed(account_id.clone()), 100, account_id.clone().into()),
			BadOrigin
		);

		assert_noop!(
			OCEX::collect_fees(Origin::signed(account_id.clone()), 100, account_id.into()),
			BadOrigin
		);
	});
}

// P.S. This was to apply a DDOS attack and see the response in the mock environment
/* #[test]
fn collect_fees_ddos(){
	let account_id = create_account_id();
	new_test_ext().execute_with(||{
		// TODO! Discuss if this is expected behaviour, if not then could this be a potential DDOS?
		for x in 0..10000000 {
			assert_ok!(
				OCEX::collect_fees(
					Origin::signed(account_id.clone().into()),
					x,
					account_id.clone().into()
				)
			);
		}
	});
} */

#[test]
fn test_submit_snapshot_sender_is_not_attested_enclave() {
	let account_id = create_account_id();
	let payl: [u8; 64] = [0; 64];
	let sig = sp_application_crypto::sr25519::Signature::from_raw(payl);
	new_test_ext().execute_with(|| {
		let snapshot =
			EnclaveSnapshot::<AccountId32, WithdrawalLimit, AssetsLimit, SnapshotAccLimit> {
				snapshot_number: 1,
				snapshot_hash: H256::random(),
				withdrawals: Default::default(),
				fees: bounded_vec![],
			};
		assert_noop!(
			OCEX::submit_snapshot(Origin::signed(account_id.into()), snapshot, sig.clone().into()),
			Error::<Test>::SenderIsNotAttestedEnclave
		);
		assert_eq!(OCEX::ingress_messages().len(), 0);
	});
}

#[test]
fn test_submit_snapshot_snapshot_nonce_error() {
	let account_id = create_account_id();
	let payl: [u8; 64] = [0; 64];
	let sig = sp_application_crypto::sr25519::Signature::from_raw(payl);
	new_test_ext().execute_with(|| {
		let snapshot =
			EnclaveSnapshot::<AccountId32, WithdrawalLimit, AssetsLimit, SnapshotAccLimit> {
				snapshot_number: 2,
				snapshot_hash: H256::random(),
				withdrawals: Default::default(),
				fees: bounded_vec![],
			};
		assert_ok!(OCEX::insert_enclave(Origin::root(), account_id.clone().into()));
		assert_noop!(
			OCEX::submit_snapshot(Origin::signed(account_id.into()), snapshot, sig.clone().into()),
			Error::<Test>::SnapshotNonceError
		);

		assert_eq!(OCEX::ingress_messages().len(), 0);
	});
}

#[test]
fn test_submit_snapshot_enclave_signature_verification_failed() {
	let account_id = create_account_id();
	let payl: [u8; 64] = [0; 64];
	let sig = sp_application_crypto::sr25519::Signature::from_raw(payl);
	new_test_ext().execute_with(|| {
		let snapshot =
			EnclaveSnapshot::<AccountId32, WithdrawalLimit, AssetsLimit, SnapshotAccLimit> {
				snapshot_number: 1,
				snapshot_hash: H256::random(),
				withdrawals: Default::default(),
				fees: bounded_vec![],
			};
		assert_ok!(OCEX::insert_enclave(Origin::root(), account_id.clone().into()));
		assert_noop!(
			OCEX::submit_snapshot(Origin::signed(account_id.into()), snapshot, sig.clone().into()),
			Error::<Test>::EnclaveSignatureVerificationFailed
		);

		assert_eq!(OCEX::ingress_messages().len(), 0);
	});
}

#[test]
fn test_submit_snapshot_bad_origin() {
	let payl: [u8; 64] = [0; 64];
	let sig = sp_application_crypto::sr25519::Signature::from_raw(payl);
	new_test_ext().execute_with(|| {
		let snapshot =
			EnclaveSnapshot::<AccountId32, WithdrawalLimit, AssetsLimit, SnapshotAccLimit> {
				snapshot_number: 0,
				snapshot_hash: H256::random(),
				withdrawals: Default::default(),
				fees: bounded_vec![],
			};
		assert_noop!(
			OCEX::submit_snapshot(Origin::root(), snapshot.clone(), sig.clone().into()),
			BadOrigin
		);

		assert_noop!(
			OCEX::submit_snapshot(Origin::root(), snapshot, sig.clone().into()),
			BadOrigin
		);
	});
}

#[test]
fn test_submit_snapshot() {
	let account_id = create_account_id();
	const PHRASE: &str =
		"news slush supreme milk chapter athlete soap sausage put clutch what kitten";
	let public_key_store = KeyStore::new();
	let public_key = SyncCryptoStore::sr25519_generate_new(
		&public_key_store,
		KEY_TYPE,
		Some(&format!("{}/hunter1", PHRASE)),
	)
	.expect("Unable to create sr25519 key pair");
	let mut t = new_test_ext();
	t.register_extension(KeystoreExt(Arc::new(public_key_store)));
	t.execute_with(|| {
		let withdrawal = create_withdrawal::<Test>();
		let mut withdrawal_map: BoundedBTreeMap<
			AccountId,
			BoundedVec<Withdrawal<AccountId>, WithdrawalLimit>,
			SnapshotAccLimit,
		> = BoundedBTreeMap::new();
		withdrawal_map.try_insert(account_id.clone(), bounded_vec![withdrawal]).unwrap();
		let snapshot =
			EnclaveSnapshot::<AccountId32, WithdrawalLimit, AssetsLimit, SnapshotAccLimit> {
				snapshot_number: 1,
				snapshot_hash: H256::random(),
				withdrawals: withdrawal_map.clone(),
				fees: bounded_vec![],
			};
		assert_ok!(OCEX::insert_enclave(Origin::root(), account_id.clone().into()));
		let bytes = snapshot.encode();
		let signature = public_key.sign(KEY_TYPE, &bytes).unwrap();

		assert_ok!(OCEX::submit_snapshot(
			Origin::signed(account_id.into()),
			snapshot.clone(),
			signature.clone().into()
		),);
		assert_eq!(Withdrawals::<Test>::contains_key(1), true);
		assert_eq!(Withdrawals::<Test>::get(1), withdrawal_map.clone());
		assert_eq!(FeesCollected::<Test>::contains_key(1), true);
		assert_eq!(Snapshots::<Test>::contains_key(1), true);
		assert_eq!(Snapshots::<Test>::get(1).unwrap(), snapshot.clone());
		assert_eq!(SnapshotNonce::<Test>::get().unwrap(), 1);
		let onchain_events: BoundedVec<
			polkadex_primitives::ocex::OnChainEvents<AccountId>,
			polkadex_primitives::OnChainEventsLimit,
		> = bounded_vec![polkadex_primitives::ocex::OnChainEvents::GetStorage(
			polkadex_primitives::ocex::Pallet::OCEX,
			polkadex_primitives::ocex::StorageItem::Withdrawal,
			1
		)];
		assert_eq!(OnChainEvents::<Test>::get(), onchain_events);
		// Checking for redundant data inside snapshot
		let withdrawal_map_empty: BoundedBTreeMap<
			AccountId,
			BoundedVec<Withdrawal<AccountId>, WithdrawalLimit>,
			SnapshotAccLimit,
		> = BoundedBTreeMap::new();
		let empty_fees: BoundedVec<Fees, AssetsLimit> = bounded_vec![];

		assert_eq!(Snapshots::<Test>::get(1).unwrap().fees, empty_fees);
		assert_eq!(Snapshots::<Test>::get(1).unwrap().withdrawals, withdrawal_map_empty);
	})
}

#[test]
fn test_register_enclave_not_whitelist() {
	let account_id = create_account_id();

	new_test_ext().execute_with(|| {
		Timestamp::set_timestamp(TEST4_SETUP.timestamp.checked_into().unwrap());
		assert_noop!(
			OCEX::register_enclave(Origin::signed(account_id.clone()), TEST4_SETUP.cert.to_vec()),
			Error::<Test>::EnclaveNotWhitelisted
		);
	});
}

#[test]
fn test_register_enclave() {
	let account_id = create_account_id();

	new_test_ext().execute_with(|| {
		Timestamp::set_timestamp(TEST4_SETUP.timestamp.checked_into().unwrap());
		let enclave_account_id = create_signer::<Test>();
		assert_ok!(OCEX::whitelist_enclave(Origin::root(), enclave_account_id));

		assert_ok!(OCEX::register_enclave(
			Origin::signed(account_id.clone()),
			TEST4_SETUP.cert.to_vec()
		));
	});
}

#[test]
fn test_whitelist_enclave() {
	let account_id = create_account_id();

	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::whitelist_enclave(Origin::root(), account_id));
	});
}

#[test]
fn test_whitelist_enclave_bad_origin() {
	let account_id = create_account_id();

	new_test_ext().execute_with(|| {
		assert_noop!(OCEX::whitelist_enclave(Origin::none(), account_id.clone()), BadOrigin);

		assert_noop!(
			OCEX::whitelist_enclave(Origin::signed(account_id.clone()), account_id),
			BadOrigin
		);
	});
}

#[test]
fn test_register_enclave_empty_report() {
	let account_id = create_account_id();
	let ias_report = vec![];
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::register_enclave(Origin::signed(account_id), ias_report),
			Error::<Test>::RemoteAttestationVerificationFailed
		);
	});
}

#[test]
fn test_reigster_enclave_bad_origin() {
	new_test_ext().execute_with(|| {
		assert_noop!(OCEX::register_enclave(Origin::root(), vec![]), BadOrigin);

		assert_noop!(OCEX::register_enclave(Origin::none(), vec![]), BadOrigin);
	});
}

#[test]
fn test_withdrawal_invalid_withdrawal_index() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		assert_noop!(
			OCEX::claim_withdraw(Origin::signed(account_id.clone().into()), 1, account_id.clone()),
			Error::<Test>::InvalidWithdrawalIndex
		);
	});
}

#[test]
fn test_withdrawal() {
	let account_id = create_account_id();
	let custodian_account = OCEX::get_custodian_account();
	const PHRASE: &str =
		"news slush supreme milk chapter athlete soap sausage put clutch what kitten";
	let public_key_store = KeyStore::new();
	let public_key = SyncCryptoStore::sr25519_generate_new(
		&public_key_store,
		KEY_TYPE,
		Some(&format!("{}/hunter1", PHRASE)),
	)
	.expect("Unable to create sr25519 key pair");
	let mut t = new_test_ext();
	t.register_extension(KeystoreExt(Arc::new(public_key_store)));
	t.execute_with(|| {
		mint_into_account(account_id.clone());
		mint_into_account(custodian_account.clone());
		// Initial Balances
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(account_id.clone()),
			10000000000000000000000
		);
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(custodian_account.clone()),
			10000000000000000000000
		);
		let withdrawal = create_withdrawal::<Test>();
		let mut withdrawal_map: BoundedBTreeMap<
			AccountId,
			BoundedVec<Withdrawal<AccountId>, WithdrawalLimit>,
			SnapshotAccLimit,
		> = BoundedBTreeMap::new();
		withdrawal_map
			.try_insert(account_id.clone(), bounded_vec![withdrawal.clone()])
			.unwrap();

		let snapshot =
			EnclaveSnapshot::<AccountId32, WithdrawalLimit, AssetsLimit, SnapshotAccLimit> {
				snapshot_number: 1,
				snapshot_hash: H256::random(),
				withdrawals: withdrawal_map,
				fees: bounded_vec![],
			};
		assert_ok!(OCEX::insert_enclave(Origin::root(), account_id.clone().into()));
		let bytes = snapshot.encode();
		let signature = public_key.sign(KEY_TYPE, &bytes).unwrap();

		assert_ok!(OCEX::submit_snapshot(
			Origin::signed(account_id.clone().into()),
			snapshot,
			signature.clone().into()
		),);

		assert_ok!(OCEX::claim_withdraw(
			Origin::signed(account_id.clone().into()),
			1,
			account_id.clone()
		));
		// Balances after withdrawal
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(account_id.clone()),
			10000000100000000000000
		);
		assert_eq!(
			<Test as Config>::NativeCurrency::free_balance(custodian_account.clone()),
			9999999900000000000000,
		);
		let withdrawal_claimed: polkadex_primitives::ocex::OnChainEvents<AccountId> =
			polkadex_primitives::ocex::OnChainEvents::OrderBookWithdrawalClaimed(
				1,
				account_id.clone().into(),
				bounded_vec![withdrawal],
			);
		assert_eq!(OnChainEvents::<Test>::get()[1], withdrawal_claimed);
	});
}
#[test]
fn test_onchain_events_overflow() {
	let account_id = create_account_id();
	let custodian_account = OCEX::get_custodian_account();
	const PHRASE: &str =
		"news slush supreme milk chapter athlete soap sausage put clutch what kitten";
	let public_key_store = KeyStore::new();
	let public_key = SyncCryptoStore::sr25519_generate_new(
		&public_key_store,
		KEY_TYPE,
		Some(&format!("{}/hunter1", PHRASE)),
	)
	.expect("Unable to create sr25519 key pair");
	// create 500 accounts
	let mut account_id_vector: Vec<AccountId> = vec![];
	for x in 0..500 {
		let account_id_500 = create_account_id_500(x as u32);
		account_id_vector.push(account_id_500);
	}
	let mut t = new_test_ext();
	t.register_extension(KeystoreExt(Arc::new(public_key_store)));
	t.execute_with(|| {
		mint_into_account(account_id.clone());
		mint_into_account(custodian_account.clone());
		let withdrawal = create_withdrawal::<Test>();
		let mut withdrawal_map: BoundedBTreeMap<
			AccountId,
			BoundedVec<Withdrawal<AccountId>, WithdrawalLimit>,
			SnapshotAccLimit,
		> = BoundedBTreeMap::new();
		withdrawal_map
			.try_insert(account_id.clone(), bounded_vec![withdrawal.clone()])
			.unwrap();
		for x in account_id_vector.clone() {
			withdrawal_map.try_insert(x, bounded_vec![withdrawal.clone()]).unwrap();
		}

		let snapshot =
			EnclaveSnapshot::<AccountId32, WithdrawalLimit, AssetsLimit, SnapshotAccLimit> {
				snapshot_number: 1,
				snapshot_hash: H256::random(),
				withdrawals: withdrawal_map,
				fees: bounded_vec![],
			};
		assert_ok!(OCEX::insert_enclave(Origin::root(), account_id.clone().into()));
		let bytes = snapshot.encode();
		let signature = public_key.sign(KEY_TYPE, &bytes).unwrap();

		assert_ok!(OCEX::submit_snapshot(
			Origin::signed(account_id.clone().into()),
			snapshot,
			signature.clone().into()
		),);

		// Perform withdraw for 500 accounts
		for x in 0..account_id_vector.len() - 1 {
			assert_ok!(OCEX::claim_withdraw(
				Origin::signed(account_id_vector[x].clone().into()),
				1,
				account_id_vector[x].clone()
			));
		}
		let last_account = account_id_vector.len() - 1;
		assert_noop!(
			OCEX::claim_withdraw(
				Origin::signed(account_id_vector[last_account].clone().into()),
				1,
				account_id_vector[last_account].clone()
			),
			Error::<Test>::OnchainEventsBoundedVecOverflow
		);

		// Cleanup Onchain events
		<OCEX as OnInitialize<u64>>::on_initialize(0);
		assert_eq!(OnChainEvents::<Test>::get().len(), 0);

		// Perform withdraw now
		assert_ok!(OCEX::claim_withdraw(
			Origin::signed(account_id_vector[last_account].clone().into()),
			1,
			account_id_vector[last_account].clone()
		));
	});
}

#[test]
fn test_withdrawal_bad_origin() {
	new_test_ext().execute_with(|| {
		let account_id = create_account_id();
		assert_noop!(OCEX::claim_withdraw(Origin::root(), 1, account_id.clone()), BadOrigin);

		assert_noop!(OCEX::claim_withdraw(Origin::none(), 1, account_id.clone()), BadOrigin);
	});
}

#[test]
fn test_shutdown() {
	new_test_ext().execute_with(|| {
		assert_ok!(OCEX::shutdown(Origin::root()));

		let ingress_message: IngressMessages<AccountId32> = IngressMessages::Shutdown;
		assert_eq!(OCEX::ingress_messages()[0], ingress_message);
		assert_eq!(ExchangeState::<Test>::get(), false);
	});
}

#[test]
fn test_shutdown_bad_origin() {
	let account_id = create_account_id();
	new_test_ext().execute_with(|| {
		assert_noop!(OCEX::shutdown(Origin::signed(account_id.into())), BadOrigin);

		assert_noop!(OCEX::shutdown(Origin::none()), BadOrigin);
	});
}

#[test]
fn test_unregister_timed_out_enclaves() {
	let enclave_id = create_account_id();
	new_test_ext().execute_with(|| {
		let past_ts = 1000;
		let ts: Moment = past_ts.try_into().unwrap();
		RegisteredEnclaves::<Test>::insert(enclave_id.clone(), ts);
		Timestamp::set_timestamp(past_ts + 86400000);
		<OCEX as OnInitialize<u64>>::on_initialize(100000000);
		assert_eq!(RegisteredEnclaves::<Test>::contains_key(enclave_id), false);
	});
}

fn mint_into_account(account_id: AccountId32) {
	let _result = Balances::deposit_creating(&account_id, 10000000000000000000000);
}

fn mint_into_account_large(account_id: AccountId32) {
	let _result =
		Balances::deposit_creating(&account_id, 1_000_000_000_000_000_000_000_000_000_000);
}

#[allow(dead_code)]
fn create_asset_and_credit(asset_id: u128, account_id: AccountId32) {
	assert_ok!(Assets::create(
		Origin::signed(account_id.clone().into()),
		asset_id.into(),
		account_id.clone().into(),
		100_u128
	));
}

fn create_account_id() -> AccountId32 {
	const PHRASE: &str =
		"news slush supreme milk chapter athlete soap sausage put clutch what kitten";
	let keystore = KeyStore::new();
	let account_id: AccountId32 = SyncCryptoStore::sr25519_generate_new(
		&keystore,
		KEY_TYPE,
		Some(&format!("{}/hunter1", PHRASE)),
	)
	.expect("Unable to create sr25519 key pair")
	.try_into()
	.expect("Unable to convert to AccountId32");

	return account_id
}
fn create_account_id_500(uid: u32) -> AccountId32 {
	const PHRASE: &str =
		"news slush supreme milk chapter athlete soap sausage put clutch what kitten";
	let keystore = KeyStore::new();
	let account_id: AccountId32 = SyncCryptoStore::sr25519_generate_new(
		&keystore,
		KEY_TYPE,
		Some(&format!("{}/hunter{}", PHRASE, uid)),
	)
	.expect("Unable to create sr25519 key pair")
	.try_into()
	.expect("Unable to convert to AccountId32");

	return account_id
}

fn create_proxy_account() -> AccountId32 {
	const PHRASE: &str =
		"news slush supreme milk chapter athlete soap sausage put clutch what kitten";
	let keystore = KeyStore::new();
	let account_id: AccountId32 = SyncCryptoStore::sr25519_generate_new(
		&keystore,
		KEY_TYPE,
		Some(&format!("{}/hunter2", PHRASE)),
	)
	.expect("Unable to create sr25519 key pair")
	.try_into()
	.expect("Unable to convert to AccountId32");

	return account_id
}

#[allow(dead_code)]
fn create_public_key() -> sp_application_crypto::sr25519::Public {
	const PHRASE: &str =
		"news slush supreme milk chapter athlete soap sausage put clutch what kitten";
	let keystore = KeyStore::new();
	let account_id = SyncCryptoStore::sr25519_generate_new(
		&keystore,
		KEY_TYPE,
		Some(&format!("{}/hunter1", PHRASE)),
	)
	.expect("Unable to create sr25519 key pair");

	return account_id
}

pub fn create_withdrawal<T: Config>() -> Withdrawal<AccountId32> {
	let account_id = create_account_id();
	let withdrawal: Withdrawal<AccountId32> = Withdrawal {
		main_account: account_id,
		asset: AssetId::polkadex,
		amount: 100_u32.into(),
		event_id: 0,
		fees: 1_u32.into(),
	};
	return withdrawal
}

pub fn create_fees<T: Config>() -> Fees {
	let fees: Fees = Fees { asset: AssetId::polkadex, amount: Decimal::new(100, 1) };
	return fees
}

pub fn create_signer<T: Config>() -> T::AccountId {
	let signer: T::AccountId = T::AccountId::decode(&mut &TEST4_SETUP.signer_pub[..]).unwrap();
	return signer
}
